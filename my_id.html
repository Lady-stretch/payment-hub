<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evolution Elite | Apple Style</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª—è Apple Fitness */
            --primary: #ffffff;
            --secondary: rgba(255, 255, 255, 0.55);
            --accent: #FF9F0A; /* –¢–æ—Ç —Å–∞–º—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
            --accent-glow: rgba(255, 159, 10, 0.4);
            
            --glass-bg: rgba(20, 20, 20, 0.65); /* –¢–µ–º–Ω–æ–µ —Å—Ç–µ–∫–ª–æ */
            --glass-border: rgba(255, 255, 255, 0.12);
            --blur: 25px; /* –°–∏–ª–∞ —Ä–∞–∑–º—ã—Ç–∏—è —Ñ–æ–Ω–∞ */
            
            --energy-low: #30D158; /* Green */
            --energy-mid: #FF9F0A; /* Orange */
            --energy-high: #FF375F; /* Pink/Red */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; padding: 0;
            font-family: 'Inter', -apple-system, sans-serif;
            color: var(--primary);
            /* –§–û–ù–û–í–û–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï */
            background: url('bg.jpg') no-repeat center center fixed; 
            background-size: cover;
            /* –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ—Ç, –±—É–¥–µ—Ç —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
            background-color: #000;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        /* HERO SECTION (–°—á–µ—Ç—á–∏–∫ –∫–∞–∫ –≤ –∫–æ–ª—å—Ü–∞—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏) */
        .hero {
            padding: 60px 20px 20px;
            text-align: center;
        }
        .hero-label { font-size: 13px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; color: var(--secondary); margin-bottom: 5px; }
        .hero-count { 
            font-size: 72px; font-weight: 800; line-height: 1; 
            background: linear-gradient(180deg, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .hero-sub { font-size: 14px; color: var(--accent); font-weight: 500; margin-top: 5px; }

        /* –û–ë–©–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .container {
            max-width: 600px; margin: 0 auto; padding: 0 16px;
            display: flex; flex-direction: column; gap: 24px;
        }

        /* PREMIUM GLASS CARD */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur));
            border: 1px solid var(--glass-border);
            border-radius: 28px; /* –°–∏–ª—å–Ω–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–∞–∫ –≤ iOS */
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            overflow: hidden; position: relative;
        }

        .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-title { font-size: 17px; font-weight: 600; color: #fff; }
        .card-icon { font-size: 18px; color: var(--secondary); }

        /* CHART AREA */
        .chart-container { height: 180px; width: 100%; }

        /* ENERGY SELECTOR (Segemented Control style) */
        .energy-wrapper {
            display: flex; background: rgba(0,0,0,0.3); 
            border-radius: 14px; padding: 4px; margin-bottom: 16px;
        }
        .e-btn {
            flex: 1; padding: 10px; text-align: center; font-size: 12px; font-weight: 600;
            border-radius: 10px; color: var(--secondary); cursor: pointer; transition: 0.3s;
        }
        .e-btn.active { background: #666; color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        
        /* –¶–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
        .e-btn[data-type="low"].active { background: var(--energy-low); color: #000; }
        .e-btn[data-type="mid"].active { background: var(--energy-mid); color: #000; }
        .e-btn[data-type="high"].active { background: var(--energy-high); color: #fff; }

        .recommendation-box {
            font-size: 15px; line-height: 1.4; color: #fff; 
            margin-top: 10px; padding: 10px; border-left: 3px solid var(--accent);
            background: rgba(255, 159, 10, 0.1); border-radius: 0 12px 12px 0;
        }

        /* METRICS ROW */
        .metrics-row { display: flex; gap: 12px; margin-bottom: 12px; }
        .m-input {
            flex: 1; background: rgba(255,255,255,0.08); border: none;
            border-radius: 12px; padding: 16px; color: #fff; font-size: 16px; font-weight: 500; text-align: center;
        }
        .m-input::placeholder { color: rgba(255,255,255,0.3); }
        .btn-update {
            width: 100%; background: #fff; color: #000; font-weight: 700;
            padding: 16px; border-radius: 14px; border: none; font-size: 14px; cursor: pointer;
        }
        
        /* STATS DISPLAY */
        .stats-display { display: flex; justify-content: space-around; margin-bottom: 15px; text-align: center; }
        .stat-val { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
        .stat-label { font-size: 11px; color: var(--secondary); text-transform: uppercase; }

        /* TRAINING GRID */
        .section-label { font-size: 13px; font-weight: 600; color: var(--secondary); margin: 20px 0 10px; padding-left: 5px; text-transform: uppercase; letter-spacing: 1px; }
        
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .t-card {
            background: rgba(255,255,255,0.05); border-radius: 18px; padding: 16px;
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 90px; cursor: pointer; transition: 0.2s;
            border: 1px solid transparent;
        }
        
        .t-card:active { transform: scale(0.97); background: rgba(255,255,255,0.1); }
        
        .t-name { font-size: 14px; font-weight: 600; line-height: 1.3; }
        .t-count { font-size: 12px; color: var(--secondary); margin-top: 8px; }

        /* Visual States */
        .t-card.highlight { 
            background: rgba(255, 159, 10, 0.15); 
            border-color: var(--accent); 
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .t-card.dimmed { opacity: 0.4; } /* –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–ª–∏–∫, –ø—Ä–æ—Å—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –≥–∞—Å–∏—Ç */

        /* MODAL (BIOHACKING) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 999; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-window {
            width: 90%; max-width: 400px;
            background: rgba(30, 30, 30, 0.9); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 32px; padding: 32px 24px; text-align: center;
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .modal-active { display: flex; opacity: 1; }
        .modal-active .modal-window { transform: scale(1); }
        
        .m-head { font-size: 22px; font-weight: 700; color: #fff; margin-bottom: 12px; }
        .m-body { font-size: 15px; line-height: 1.5; color: rgba(255,255,255,0.8); margin-bottom: 24px; }
        .m-badge { 
            display: inline-block; background: linear-gradient(135deg, #FF9F0A, #FF375F); 
            padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; 
            margin-bottom: 20px; box-shadow: 0 5px 15px rgba(255, 55, 95, 0.4);
        }

    </style>
</head>
<body>

    <div class="hero">
        <div class="hero-label">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
        <div class="hero-count" id="total-display">0</div>
        <div class="hero-sub" id="level-display">–ù–∞—á–∞–ª–æ –ø—É—Ç–∏</div>
    </div>

    <div class="container">

        <div class="card">
            <div class="card-head">
                <span class="card-title">–î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</span>
                <span class="card-icon">üìà</span>
            </div>
            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-head">
                <span class="card-title">–£—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏</span>
                <span class="card-icon">‚ö°</span>
            </div>
            
            <div class="energy-wrapper">
                <div class="e-btn" data-type="low" onclick="setEnergy('low')">–°–ø–∞–¥</div>
                <div class="e-btn active" data-type="mid" onclick="setEnergy('mid')">–ë–∞–ª–∞–Ω—Å</div>
                <div class="e-btn" data-type="high" onclick="setEnergy('high')">–ü–∏–∫ —Å–∏–ª—ã</div>
            </div>

            <div class="recommendation-box" id="rec-text">
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º: <strong>–ü–∏–ª–∞—Ç–µ—Å, –ü–æ–¥–∫–∞—á–∫–∞, –ì–∞–º–∞–∫–∏</strong>
            </div>
        </div>

        <div class="card">
            <div class="card-head">
                <span class="card-title">–ë–∏–æ–º–µ—Ç—Ä–∏—è</span>
                <span class="card-icon">üß¨</span>
            </div>

            <div class="stats-display">
                <div>
                    <div class="stat-val" id="bmi-val" style="color: #fff;">--</div>
                    <div class="stat-label">–ò–ú–¢</div>
                </div>
                <div>
                    <div class="stat-val" id="tdee-val" style="color: var(--energy-low);">--</div>
                    <div class="stat-label">–ö–∫–∞–ª / –î–µ–Ω—å</div>
                </div>
            </div>

            <div class="metrics-row">
                <input type="number" id="w-in" class="m-input" placeholder="–í–µ—Å (–∫–≥)">
                <input type="number" id="h-in" class="m-input" placeholder="–†–æ—Å—Ç (—Å–º)">
            </div>
            <button class="btn-update" onclick="saveMetrics()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ä—ã</button>
        </div>

        <div style="margin-bottom: 40px;">
            <div class="section-label">Mind & Body (–°–ø–æ–∫–æ–π–Ω—ã–µ)</div>
            <div class="grid-container" id="calm-grid"></div>

            <div class="section-label">Power & Sculpt (–ê–∫—Ç–∏–≤–Ω—ã–µ)</div>
            <div class="grid-container" id="active-grid"></div>
        </div>

    </div>

    <div class="modal-overlay" id="modal" onclick="closeModal()">
        <div class="modal-window" onclick="event.stopPropagation()">
            <div id="m-head" class="m-head"></div>
            <div id="m-badge-container"></div>
            <div id="m-body" class="m-body"></div>
            <button class="btn-update" style="background: rgba(255,255,255,0.1); color: #fff;" onclick="closeModal()">–û—Ç–ª–∏—á–Ω–æ</button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // === DATA STORE ===
    let db = JSON.parse(localStorage.getItem('ls_apple_db')) || {
        workouts: {},
        history: { weight: [], dates: [] },
        height: null
    };

    // === CONFIG ===
    const workoutsData = [
        // CALM
        { id: 'mfr', n: '–ú–§–†', type: 'low', cat: 'calm', desc: '–†–∞—Å–∫–∞—Ç–∫–∞ —Ñ–∞—Å—Ü–∏–π —É–±–∏—Ä–∞–µ—Ç –æ—Ç–µ–∫–∏ –∏ –∑–∞–∂–∏–º—ã.' },
        { id: 'yoga', n: '–ô–æ–≥–∞ –†–µ–ª–∞–∫—Å', type: 'low', cat: 'calm', desc: '–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ—Ä—Ç–∏–∑–æ–ª–∞, –≥–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ.' },
        { id: 'str', n: '–°—Ç—Ä–µ—Ç—á–∏–Ω–≥', type: 'low', cat: 'calm', desc: '–ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è —Ç–∫–∞–Ω–µ–π –∏ –≤–æ–∑–≤—Ä–∞—Ç –≥–∏–±–∫–æ—Å—Ç–∏.' },
        { id: 'back', n: '–ó–¥–æ—Ä–æ–≤–∞—è –°–ø–∏–Ω–∞', type: 'low', cat: 'calm', desc: '–°–Ω—è—Ç–∏–µ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ —Å –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞.' },
        { id: 'pil', n: '–ü–∏–ª–∞—Ç–µ—Å', type: 'mid', cat: 'calm', desc: '–ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–Ω—Ç—Ä–∞ –∏ –≥–ª—É–±–æ–∫–∏—Ö –º—ã—à—Ü.' },
        { id: 'sky', n: 'Sky Stretch', type: 'mid', cat: 'calm', desc: '–õ–∏–º—Ñ–æ–¥—Ä–µ–Ω–∞–∂ –∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã–µ –ø–æ–∑—ã.' },
        // ACTIVE
        { id: 'split', n: '–ü–æ–¥–∫–∞—á–∫–∞+–®–ø–∞–≥–∞—Ç', type: 'mid', cat: 'active', desc: '–°–∏–ª–∞ + –≥–∏–±–∫–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º —Ñ–ª–∞–∫–æ–Ω–µ.' },
        { id: 'glute', n: '–Ø–≥–æ–¥–∏—Ü—ã+–ü—Ä–µ—Å—Å', type: 'mid', cat: 'active', desc: '–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–æ–Ω.' },
        { id: 'trx', n: 'TRX –ü–µ—Ç–ª–∏', type: 'high', cat: 'active', desc: '–†–∞–±–æ—Ç–∞ —Å –≤–µ—Å–æ–º —Ç–µ–ª–∞, –≤—Å–µ –º—ã—à—Ü—ã —Å—Ä–∞–∑—É.' },
        { id: 'tab', n: '–¢–∞–±–∞—Ç–∞', type: 'high', cat: 'active', desc: '–†–∞–∑–≥–æ–Ω –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞ –Ω–∞ 24 —á–∞—Å–∞.' },
        { id: 'scu', n: 'Body Sculpt', type: 'high', cat: 'active', desc: '–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–æ—Ç–Ω–æ–≥–æ –º—ã—à–µ—á–Ω–æ–≥–æ –∫–æ—Ä—Å–µ—Ç–∞.' },
        { id: 'circ', n: '–ö—Ä—É–≥–æ–≤–∞—è', type: 'high', cat: 'active', desc: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ.' }
    ];

    const milestones = {
        10: "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏",
        25: "–ü—Ä–∏–≤—ã—á–∫–∞",
        50: "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è",
        100: "–ù–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫"
    };

    let currentFilter = 'mid'; // low, mid, high

    // === INIT ===
    function init() {
        if(db.height) document.getElementById('h-in').value = db.height;
        const lastW = db.history.weight[db.history.weight.length-1];
        if(lastW) document.getElementById('w-in').value = lastW;

        renderGrid();
        updateUI();
        initChart();
        setEnergy('mid'); // Default view
    }

    // === LOGIC ===
    function setEnergy(type) {
        currentFilter = type;
        
        // 1. Update Buttons Visuals
        document.querySelectorAll('.e-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.type === type);
        });

        // 2. Update Recommendation Text (Big & Orange)
        const recs = {
            'low': '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: –ú–§–†, –ô–æ–≥–∞, –°–ø–∏–Ω–∞',
            'mid': '–¢–æ–Ω—É—Å: –ü–∏–ª–∞—Ç–µ—Å, –ì–∞–º–∞–∫–∏, –ú–∏–∫—Å',
            'high': '–ñ–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ: –¢–∞–±–∞—Ç–∞, TRX, –°–∫—É–ª—å–ø—Ç'
        };
        const txt = document.getElementById('rec-text');
        txt.innerHTML = `–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º: <span style="color:var(--accent); font-weight:700;">${recs[type]}</span>`;

        // 3. Highlight Cards (But keep clickable)
        renderGrid(); // Re-render logic to apply styles
        tg.HapticFeedback.selectionChanged();
    }

    function renderGrid() {
        const cGrid = document.getElementById('calm-grid');
        const aGrid = document.getElementById('active-grid');
        cGrid.innerHTML = ''; aGrid.innerHTML = '';

        workoutsData.forEach(w => {
            const count = db.workouts[w.id] || 0;
            const card = document.createElement('div');
            
            // Logic for highlighting based on energy level
            let classes = 't-card';
            if (w.type === currentFilter) {
                classes += ' highlight'; // Orange Glow
            } else {
                classes += ' dimmed'; // Fade out slightly
            }

            card.className = classes;
            card.innerHTML = `
                <div class="t-name">${w.n}</div>
                <div class="t-count">${count} –ø–æ—Å–µ—â–µ–Ω–∏–π</div>
            `;
            
            // IMPORTANT: Click always works!
            card.onclick = () => addWorkout(w);

            if(w.cat === 'calm') cGrid.appendChild(card);
            else aGrid.appendChild(card);
        });
    }

    function addWorkout(w) {
        db.workouts[w.id] = (db.workouts[w.id] || 0) + 1;
        save();
        updateUI();
        renderGrid();
        
        // Modal
        const total = getTotal();
        let badgeHtml = '';
        if(milestones[total]) badgeHtml = `<div class="m-badge">üèÜ ${milestones[total]}</div>`;

        document.getElementById('m-head').innerText = w.n;
        document.getElementById('m-body').innerText = w.desc;
        document.getElementById('m-badge-container').innerHTML = badgeHtml;
        
        const m = document.getElementById('modal');
        m.style.display = 'flex';
        setTimeout(() => m.classList.add('modal-active'), 10);
        tg.HapticFeedback.notificationOccurred('success');
    }

    function closeModal() {
        const m = document.getElementById('modal');
        m.classList.remove('modal-active');
        setTimeout(() => m.style.display = 'none', 300);
    }

    function saveMetrics() {
        const w = parseFloat(document.getElementById('w-in').value);
        const h = parseFloat(document.getElementById('h-in').value);
        
        if(w && h) {
            db.height = h;
            db.history.weight.push(w);
            db.history.dates.push(new Date().toLocaleDateString('ru', {day:'numeric', month:'short'}));
            if(db.history.weight.length > 7) { // Keep clean
                db.history.weight.shift(); db.history.dates.shift();
            }
            save();
            updateUI();
            initChart(); // Refresh chart
            tg.HapticFeedback.notificationOccurred('success');
        }
    }

    function getTotal() {
        return Object.values(db.workouts).reduce((a,b)=>a+b,0);
    }

    function updateUI() {
        const total = getTotal();
        document.getElementById('total-display').innerText = total;
        
        // Level logic
        let level = "–ù–æ–≤–∏—á–æ–∫";
        if(total > 10) level = "–õ—é–±–∏—Ç–µ–ª—å";
        if(total > 30) level = "–ê—Ç–ª–µ—Ç";
        if(total > 50) level = "Pro Biohacker";
        if(total > 100) level = "Elite";
        document.getElementById('level-display').innerText = level;

        // Metrics Calc
        const h = db.height;
        const w = db.history.weight[db.history.weight.length-1];
        if(h && w) {
            // BMI
            const bmi = (w / ((h/100)**2)).toFixed(1);
            const bmiEl = document.getElementById('bmi-val');
            bmiEl.innerText = bmi;
            bmiEl.style.color = bmi < 25 ? '#30D158' : '#FF9F0A';

            // TDEE (Simplified Mifflin)
            // Activity factor dynamic
            let act = 1.2;
            if(total > 15) act = 1.375;
            if(total > 40) act = 1.55;
            
            const bmr = (10*w) + (6.25*h) - (5*30) - 161;
            const tdee = Math.round(bmr * act);
            document.getElementById('tdee-val').innerText = tdee;
        }
    }

    let chartInstance;
    function initChart() {
        const ctx = document.getElementById('weightChart').getContext('2d');
        if(chartInstance) chartInstance.destroy();

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: db.history.dates.length ? db.history.dates : ['Start'],
                datasets: [{
                    data: db.history.weight,
                    borderColor: '#FF9F0A',
                    borderWidth: 3,
                    backgroundColor: 'rgba(255, 159, 10, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: {display:false} },
                scales: {
                    x: { display: false },
                    y: { display: false } // Minimalist chart
                }
            }
        });
    }

    function save() { localStorage.setItem('ls_apple_db', JSON.stringify(db)); }

    init();

</script>
</body>
</html>
