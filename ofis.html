<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lady Stretch | Evolution System v8.7 Premium</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* [1] –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï */
        :root {
            --accent-gold: #ffd700;
            --accent-white: #ffffff;
            --accent-red: #ff3b30;
            --accent-green: #34c759;
            --accent-blue: #007aff;
            
            --bg-dark: #000000;
            --glass-base: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-hover: rgba(255, 255, 255, 0.15);
            
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-tertiary: rgba(255, 255, 255, 0.3);
            
            --font-main: 'Inter', sans-serif;
            --transition-main: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-gold: 0 0 25px rgba(255, 215, 0, 0.3);
            --shadow-white: 0 10px 30px rgba(255, 255, 255, 0.2);
        }

        /* [2] –ë–ê–ó–û–í–´–ô –°–ë–†–û–° */
        * {
            margin-top: 0px;
            margin-bottom: 0px;
            margin-left: 0px;
            margin-right: 0px;
            padding-top: 0px;
            padding-bottom: 0px;
            padding-left: 0px;
            padding-right: 0px;
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
            /* –§–û–ù –° –î–ï–í–£–®–ö–û–ô */
            background-image: linear-gradient(180deg, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.85) 100%), 
                              url('https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?q=80&w=2040&auto=format&fit=crop');
            background-attachment: fixed;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            zoom: 0.88;
        }

        /* [3] –ü–†–ï–õ–û–ê–î–ï–† (–ó–ê–°–¢–ê–í–ö–ê) */
        #evolution-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease-in-out;
        }

        .loader-thread {
            width: 2px;
            height: 150px;
            background: linear-gradient(to bottom, transparent, var(--accent-gold), transparent);
            margin-bottom: 40px;
            box-shadow: 0 0 20px var(--accent-gold);
        }

        .loader-brand {
            font-size: 32px;
            font-weight: 100;
            letter-spacing: 22px;
            color: #fff;
            text-transform: uppercase;
            text-indent: 22px;
            margin-bottom: 20px;
        }

        .loader-info {
            font-size: 10px;
            letter-spacing: 5px;
            color: var(--text-tertiary);
            text-transform: uppercase;
        }

        /* [4] –®–ê–ü–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø */
        .header-main {
            position: sticky;
            top: 0;
            width: 100%;
            height: 120px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(50px);
            -webkit-backdrop-filter: blur(50px);
            border-bottom-width: 1px;
            border-bottom-style: solid;
            border-bottom-color: var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 30px;
            padding-right: 30px;
            z-index: 1000;
        }

        .brand-container {
            display: flex;
            flex-direction: column;
        }

        .brand-title {
            font-size: 26px;
            font-weight: 200;
            letter-spacing: 5px;
            color: var(--accent-white);
        }

        .brand-badge {
            font-size: 10px;
            font-weight: 800;
            color: var(--accent-gold);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .stat-circle {
            text-align: right;
        }

        .stat-value {
            font-size: 58px;
            font-weight: 100;
            color: var(--accent-gold);
            line-height: 0.8;
        }

        .stat-label {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
        }

        /* [5] –ö–û–ù–¢–ï–ô–ù–ï–† –ò –°–ï–¢–ö–ê */
        .wrapper {
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 40px;
            padding-bottom: 60px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: var(--text-tertiary);
            margin-top: 50px;
            margin-bottom: 25px;
            padding-left: 10px;
        }

        .card-glass {
            background-color: var(--glass-base);
            border-width: 1px;
            border-style: solid;
            border-color: var(--glass-border);
            border-radius: 35px;
            padding-top: 35px;
            padding-bottom: 35px;
            padding-left: 30px;
            padding-right: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            transition: var(--transition-main);
            position: relative;
            overflow: hidden;
        }

        .card-glass:hover {
            background-color: var(--glass-hover);
            border-color: rgba(255,255,255,0.35);
        }

        /* [6] –ö–ù–û–ü–ö–ò (–Ø–†–ö–ò–ô –°–¢–ò–õ–¨) */
        .flex-row {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn-action {
            flex: 1;
            padding-top: 25px;
            padding-bottom: 25px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            background-color: rgba(255,255,255,0.06);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }

        .btn-action.active {
            background-color: var(--accent-white);
            color: #000;
            border-color: var(--accent-white);
            transform: translateY(-4px);
            box-shadow: var(--shadow-white);
        }

        /* [7] –ü–û–õ–Ø –í–í–û–î–ê */
        .grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 40px;
        }

        .input-unit {
            position: relative;
        }

        .input-main {
            width: 100%;
            background-color: rgba(255,255,255,0.03);
            border-width: 1px;
            border-style: solid;
            border-color: var(--glass-border);
            border-radius: 25px;
            padding-top: 30px;
            padding-bottom: 30px;
            color: #fff;
            text-align: center;
            font-size: 30px;
            font-weight: 200;
            transition: 0.3s;
        }

        .input-main:focus {
            border-color: var(--accent-gold);
            background-color: rgba(255, 215, 0, 0.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }

        .input-sub {
            position: absolute;
            bottom: 12px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 8px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        /* [8] –ú–ï–¢–†–ò–ö–ò –ò –ë–ñ–£ */
        .grid-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .metric-card {
            background-color: rgba(255,255,255,0.02);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 25px 10px;
            text-align: center;
        }

        .metric-big {
            display: block;
            font-size: 32px;
            font-weight: 100;
            margin-bottom: 5px;
        }

        .metric-small {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .pfc-label-box {
            font-size: 24px;
            font-weight: 800;
            color: var(--accent-gold);
            display: block;
        }

        /* [9] –ò–ò-–°–¢–ê–¢–£–° –ü–ê–ù–ï–õ–¨ */
        .ai-panel {
            padding-top: 30px;
            padding-bottom: 30px;
            padding-left: 30px;
            padding-right: 30px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 300;
            line-height: 1.8;
            color: #f0f0f0;
            background-color: rgba(255,255,255,0.04);
            border-left-width: 6px;
            border-left-style: solid;
            border-left-color: var(--accent-green);
            margin-bottom: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        /* [10] –°–ï–¢–ö–ê –¢–†–ï–ù–ò–†–û–í–û–ö */
        .workout-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .workout-card {
            padding-top: 40px;
            padding-bottom: 30px;
            padding-left: 25px;
            padding-right: 25px;
            min-height: 190px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: var(--glass-base);
            border: 1px solid var(--glass-border);
            border-radius: 35px;
            cursor: pointer;
            transition: 0.4s;
        }

        .workout-card:active {
            transform: scale(0.94);
            background-color: var(--glass-hover);
        }

        .workout-card.dimmed {
            opacity: 0.12;
            filter: grayscale(1);
            pointer-events: none;
        }

        .workout-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.5px;
            line-height: 1.3;
        }

        .workout-stats {
            font-size: 11px;
            font-weight: 900;
            color: var(--accent-gold);
            text-transform: uppercase;
        }

        /* [11] –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê (–¶–ï–ù–¢–†) */
        .danger-zone {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 130px;
            margin-bottom: 40px;
        }

        .btn-reset {
            padding-top: 20px;
            padding-bottom: 20px;
            padding-left: 50px;
            padding-right: 50px;
            background-color: transparent;
            border-width: 2px;
            border-style: solid;
            border-color: var(--accent-red);
            border-radius: 100px;
            color: var(--accent-red);
            font-size: 12px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            cursor: pointer;
            transition: 0.4s;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.15);
        }

        .btn-reset:hover {
            background-color: var(--accent-red);
            color: #fff;
            box-shadow: 0 0 35px rgba(255, 59, 48, 0.5);
        }

        /* [12] –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .system-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.98);
            backdrop-filter: blur(50px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 25px;
        }

        .system-modal {
            width: 100%;
            max-width: 440px;
            background-color: #0a0a0a;
            border: 1px solid var(--glass-border);
            border-radius: 45px;
            padding-top: 60px;
            padding-bottom: 50px;
            padding-left: 45px;
            padding-right: 45px;
            text-align: center;
            position: relative;
        }

        .system-modal-btn {
            width: 100%;
            padding-top: 25px;
            padding-bottom: 25px;
            background-color: #fff;
            color: #000;
            border: none;
            border-radius: 25px;
            font-weight: 900;
            font-size: 16px;
            text-transform: uppercase;
            margin-top: 35px;
            cursor: pointer;
        }

        .award-gold-border {
            border-width: 2px;
            border-style: solid;
            border-color: var(--accent-gold);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        }
    </style>
</head>
<body>

<div id="evolution-loader">
    <div class="loader-thread"></div>
    <div class="loader-brand">EVOLUTION</div>
    <div class="loader-info">–°–∏—Å—Ç–µ–º–∞ Lady Stretch –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...</div>
</div>

<header class="header-main">
    <div class="brand-container">
        <div class="brand-title">LADY STRETCH</div>
        <div class="brand-badge">EVOLUTION SYSTEM</div>
    </div>
    <div class="stat-circle">
        <div class="stat-value" id="val-total-sessions">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π</div>
    </div>
</header>

<div class="wrapper">
    
    <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞—à–µ–≥–æ —Ç–µ–ª–∞</div>
    
    <div class="flex-row">
        <div class="btn-action active" id="gender-m" onclick="setGender('m')">–ú—É–∂—á–∏–Ω–∞</div>
        <div class="btn-action" id="gender-f" onclick="setGender('f')">–ñ–µ–Ω—â–∏–Ω–∞</div>
    </div>
    
    <div class="card-glass" style="padding: 25px; text-align: center; cursor: pointer;" onclick="openPalMenu()">
        –£—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–∏: <span id="label-pal-name" style="color:var(--accent-gold); font-weight: 800;">–ê–∫—Ç–∏–≤–Ω—ã–π</span>
    </div>

    <div class="grid-inputs">
        <div class="input-unit">
            <input type="number" id="input-weight" class="input-main" placeholder="0" oninput="engineSync()">
            <div class="input-sub">–í–µ—Å (–∫–≥)</div>
        </div>
        <div class="input-unit">
            <input type="number" id="input-height" class="input-main" placeholder="0" oninput="engineSync()">
            <div class="input-sub">–†–æ—Å—Ç (—Å–º)</div>
        </div>
        <div class="input-unit">
            <input type="number" id="input-age" class="input-main" placeholder="0" oninput="engineSync()">
            <div class="input-sub">–í–æ–∑—Ä–∞—Å—Ç</div>
        </div>
    </div>
    
    <div class="grid-metrics">
        <div class="metric-card"><span class="metric-big" id="res-bmi-val">--</span><span class="metric-small">–ò–Ω–¥–µ–∫—Å –ú–¢</span></div>
        <div class="metric-card"><span class="metric-big" id="res-water-val">--</span><span class="metric-small">–í–æ–¥–∞ (–ª)</span></div>
        <div class="metric-card"><span class="metric-big" id="res-kcal-val">--</span><span class="metric-small">–ö–∞–ª–æ—Ä–∏–∏</span></div>
    </div>
    
    <div id="ai-verdict-box" class="ai-panel">
        –û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö... –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Å–∞, —Ä–æ—Å—Ç–∞ –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞.
    </div>

    <div class="section-title">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –ë–ñ–£</div>
    <div class="grid-metrics">
        <div class="metric-card"><span class="pfc-label-box" id="p-gram">--</span><span class="metric-small">–ë–µ–ª–∫–∏ (–≥)</span></div>
        <div class="metric-card"><span class="pfc-label-box" id="f-gram">--</span><span class="metric-small">–ñ–∏—Ä—ã (–≥)</span></div>
        <div class="metric-card"><span class="pfc-label-box" id="c-gram">--</span><span class="metric-small">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</span></div>
    </div>

    <div class="section-title">–ö–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–π—á–∞—Å?</div>
    <div class="flex-row">
        <div class="btn-action" id="lvl-low" onclick="updateEnergy('low')">–°–ø–∞–¥</div>
        <div class="btn-action active" id="lvl-mid" onclick="updateEnergy('mid')">–ë–∞–ª–∞–Ω—Å</div>
        <div class="btn-action" id="lvl-high" onclick="updateEnergy('high')">–ü–∏–∫</div>
    </div>

    <div class="section-title">–ü—Ä–æ—Ç–æ–∫–æ–ª—ã Lady Stretch</div>
    <div class="workout-list" id="workout-engine-view">
        </div>

    <div class="section-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –Ω–µ–¥–µ–ª—é (–°–µ—Å—Å–∏–∏)</div>
    <div class="card-glass">
        <canvas id="evolutionBarChart" height="230"></canvas>
    </div>

    <div class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å–∞ —Ç–µ–ª–∞</div>
    <div class="card-glass">
        <canvas id="evolutionLineChart" height="230"></canvas>
    </div>

    <div class="danger-zone">
        <button class="btn-reset" onclick="triggerHardReset()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>
</div>

<div id="overlay-pal" class="system-overlay" onclick="closePalMenu()">
    <div class="system-modal" onclick="event.stopPropagation()">
        <div style="font-size:22px; font-weight:100; letter-spacing:5px; margin-bottom:45px;">–ê–ö–¢–ò–í–ù–û–°–¢–¨</div>
        <div class="card-glass" style="margin-bottom:20px; cursor:pointer; padding:25px;" onclick="applyPal(1.2, '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π')">
            <b>–ù–ò–ó–ö–ê–Ø</b><br><small>–°–∏–¥—è—á–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–µ—Ç —Å–ø–æ—Ä—Ç–∞</small>
        </div>
        <div class="card-glass" style="margin-bottom:20px; cursor:pointer; padding:25px;" onclick="applyPal(1.55, '–ê–∫—Ç–∏–≤–Ω—ã–π')">
            <b>–°–†–ï–î–ù–Ø–Ø</b><br><small>3-4 –∑–∞–Ω—è—Ç–∏—è –≤ Lady Stretch</small>
        </div>
        <div class="card-glass" style="cursor:pointer; padding:25px;" onclick="applyPal(1.9, '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π')">
            <b>–í–´–°–û–ö–ê–Ø</b><br><small>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏</small>
        </div>
    </div>
</div>

<div id="overlay-workout" class="system-overlay" onclick="closeWorkoutModal()">
    <div class="system-modal" onclick="event.stopPropagation()">
        <div id="modal-w-name" style="font-size:28px; font-weight:100; color:var(--accent-gold); margin-bottom:25px;"></div>
        <div id="modal-w-desc" style="font-size:16px; color:#bbb; line-height:1.9; margin-bottom:40px; text-align:left;"></div>
        <div class="ai-panel" style="margin-bottom:30px; border-left-color:var(--accent-gold); font-size:13px;">
            <b>–°–û–í–ï–¢ –≠–ö–°–ü–ï–†–¢–ê:</b> –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –æ—â—É—â–µ–Ω–∏—è—Ö –≤ –º—ã—à—Ü–∞—Ö. –ü–ª–∞–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∞–º–ø–ª–∏—Ç—É–¥—ã.
        </div>
        <button class="system-modal-btn" onclick="confirmSession()">–ó–∞—Å—á–∏—Ç–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
    </div>
</div>

<div id="overlay-award" class="system-overlay" onclick="this.style.display='none'">
    <div class="system-modal award-gold-border" onclick="event.stopPropagation()">
        <div style="font-size:65px; margin-bottom:30px;">üíé</div>
        <div id="award-title-text" style="font-size:26px; font-weight:100; color:var(--accent-gold); letter-spacing:6px; margin-bottom:25px;"></div>
        <div id="award-body-text" style="font-size:16px; color:#ddd; line-height:2; text-align:left;"></div>
        <button class="system-modal-btn" style="background:var(--accent-gold);" onclick="document.getElementById('overlay-award').style.display='none'">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—É—Ç—å</button>
    </div>
</div>

<script>
    /* ============================================================ */
    /* [13] –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ô –î–í–ò–ñ–û–ö (JAVASCRIPT) */
    /* ============================================================ */
    
    const telegramApp = window.Telegram.WebApp;
    telegramApp.expand();

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö (LocalStorage)
    let evolutionData = JSON.parse(localStorage.getItem('lady_stretch_v87_core')) || {
        gender: 'm',
        weight: '',
        height: '',
        age: 1981,
        pal: 1.55,
        palName: '–ê–∫—Ç–∏–≤–Ω—ã–π',
        sessionLog: {},
        weightHistory: { values: [], labels: [] },
        activityDays: [0, 0, 0, 0, 0, 0, 0] // –ü–Ω, –í—Ç, –°—Ä, –ß—Ç, –ü—Ç, –°–±, –í—Å
    };

    // –ü–æ–ª–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
    const evolutionLibrary = [
        { id: 'mfr', title: '–ú–§–† –¢–µ—Ä–∞–ø–∏—è', level: 'low', text: '–ì–ª—É–±–æ–∫–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Ñ–∞—Å—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é —Ä–æ–ª–ª–æ–≤ –∏ –º—è—á–µ–π. –£—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ç–æ—á–∫–∏, —É–ª—É—á—à–∞–µ—Ç –ø–∏—Ç–∞–Ω–∏–µ —Ç–∫–∞–Ω–µ–π –∏ —Å–Ω–∏–º–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å.' },
        { id: 'back', title: '–ó–¥–æ—Ä–æ–≤–∞—è –°–ø–∏–Ω–∞', level: 'low', text: '–ö–æ–º–ø–ª–µ–∫—Å –¥–ª—è –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –≥–ª—É–±–æ–∫–∏—Ö —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–æ–≤. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –æ—Å–∞–Ω–∫–∏ –∏ –∏–∑–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç –±–æ–ª–µ–π.' },
        { id: 'yoga', title: '–ô–æ–≥–∞ –†–µ–ª–∞–∫—Å', text: '–°–∏–Ω—Ç–µ–∑ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∏ –º—è–≥–∫–∏—Ö –∞—Å–∞–Ω. –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Å–∏—Ö–æ—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –±–µ—Ä–µ–∂–Ω–æ–µ —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ.' },
        { id: 'str', title: '–°—Ç—Ä–µ—Ç—á–∏–Ω–≥', level: 'low', text: '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –≥–∏–±–∫–æ—Å—Ç—å—é –≤—Å–µ–≥–æ —Ç–µ–ª–∞. –†–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≤—Å–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü –¥–ª—è –ª–µ–≥–∫–æ—Å—Ç–∏ –≤ –∫–∞–∂–¥–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏.' },
        { id: 'sky', title: 'Sky Stretch', level: 'mid', text: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –≥–∞–º–∞–∫–∞—Ö –≤ –ø–æ–¥–≤–µ—Å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—Å—Ç–∏—á—å –≥–ª—É–±–æ–∫–æ–≥–æ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –ø–æ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏.' },
        { id: 'split', title: '–®–ø–∞–≥–∞—Ç', level: 'mid', text: '–¶–µ–ª–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —à–ø–∞–≥–∞—Ç–∞. –í–∫–ª—é—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å—é —Å—É—Å—Ç–∞–≤–æ–≤ –∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–æ–∫.' },
        { id: 'pil', title: '–ü–∏–ª–∞—Ç–µ—Å', level: 'mid', text: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ Core-–º—ã—à—Ü. –§–æ—Ä–º–∏—Ä—É–µ—Ç –º—ã—à–µ—á–Ω—ã–π –∫–æ—Ä—Å–µ—Ç, –¥–µ–ª–∞–µ—Ç –∂–∏–≤–æ—Ç –ø–ª–æ—Å–∫–∏–º, –∞ –¥–≤–∏–∂–µ–Ω–∏—è ‚Äî –≥—Ä–∞—Ü–∏–æ–∑–Ω—ã–º–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–º–∏.' },
        { id: 'circ', title: '–ö—Ä—É–≥–æ–≤–∞—è', level: 'mid', text: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–∏–Ω–≥ –≤ –¥–∏–Ω–∞–º–∏–∫–µ. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –æ–±—â–µ–≥–æ —Ç–æ–Ω—É—Å–∞ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã.' },
        { id: 'tab', title: '–¢–∞–±–∞—Ç–∞ HIIT', level: 'high', text: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –ó–∞–ø—É—Å–∫–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –Ω–∞ 24 —á–∞—Å–∞ –≤–ø–µ—Ä–µ–¥. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏—è.' },
        { id: 'scu', title: 'Body Sculpt', level: 'high', text: '–°–∏–ª–æ–≤–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤ —Ç–µ–ª–∞. –ü—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–ª—å–µ—Ñ–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.' },
        { id: 'trx', title: 'TRX –ü–µ—Ç–ª–∏', level: 'high', text: '–¢—Ä–µ–Ω–∏–Ω–≥ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º –≤ –ø–µ—Ç–ª—è—Ö. –†–∞–∑–≤–∏–≤–∞–µ—Ç –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –±–∞–ª–∞–Ω—Å, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏–ª—É –º—ã—à—Ü-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.' },
        { id: 'glu', title: '–Ø–≥–æ–¥–∏—Ü—ã + –ü—Ä–µ—Å—Å', level: 'high', text: '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ –∑–æ–Ω—ã. –í—ã—Å–æ–∫–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º—ã—à—Ü –±—Ä—é—à–Ω–æ–≥–æ –ø—Ä–µ—Å—Å–∞.' }
    ];

    let activeEnergy = 'mid';
    let currentTargetID = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('DOMContentLoaded', () => {
        // –≠–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
        setTimeout(() => {
            const loader = document.getElementById('evolution-loader');
            loader.style.opacity = '0';
            setTimeout(() => { loader.style.display = 'none'; }, 1000);
        }, 2500);

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ –ø–∞–º—è—Ç–∏
        document.getElementById('input-weight').value = evolutionData.weight;
        document.getElementById('input-height').value = evolutionData.height;
        document.getElementById('input-age').value = evolutionData.age;
        document.getElementById('label-pal-name').innerText = evolutionData.palName;
        
        setGender(evolutionData.gender);
        renderWorkouts();
        initCharts();
        engineSync();
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–∞
    function setGender(g) {
        evolutionData.gender = g;
        document.getElementById('gender-m').classList.toggle('active', g === 'm');
        document.getElementById('gender-f').classList.toggle('active', g === 'f');
        engineSync();
        saveCore();
    }

    // –ì–ª–∞–≤–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫
    function engineSync() {
        const w = parseFloat(document.getElementById('input-weight').value);
        const h = parseFloat(document.getElementById('input-height').value);
        const a = parseInt(document.getElementById('input-age').value);

        if (w > 0 && h > 0 && a > 0) {
            evolutionData.weight = w;
            evolutionData.height = h;
            evolutionData.age = a;
            
            // –†–∞—Å—á–µ—Ç –ò–ú–¢
            const bmi = (w / ((h / 100) * (h / 100))).toFixed(1);
            document.getElementById('res-bmi-val').innerText = bmi;

            // –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Ä–¥–∏–∫—Ç –ò–ò
            const verdict = document.getElementById('ai-verdict-box');
            if (bmi > 25) {
                verdict.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω—É—é –º–∞—Å—Å—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ High-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ 3-—Ö –≤ –Ω–µ–¥–µ–ª—é.`;
                verdict.style.borderLeftColor = 'var(--accent-red)';
            } else if (bmi < 18.5) {
                verdict.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} –Ω–∏–∂–µ –Ω–æ—Ä–º—ã. –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ü–∏–ª–∞—Ç–µ—Å–µ –∏ Sky Stretch. –£–≤–µ–ª–∏—á—å—Ç–µ –Ω–æ—Ä–º—É –±–µ–ª–∫–∞ –≤ —Ä–∞—Ü–∏–æ–Ω–µ.`;
                verdict.style.borderLeftColor = 'var(--accent-blue)';
            } else {
                verdict.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} –≤ –∏–¥–µ–∞–ª—å–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ. –í–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–æ–Ω—É—Å–∞ –∏ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –≥–ª—É–±–æ–∫–æ–π –≥–∏–±–∫–æ—Å—Ç—å—é.`;
                verdict.style.borderLeftColor = 'var(--accent-green)';
            }

            // –ú–µ—Ç–∞–±–æ–ª–∏–∑–º –∏ –í–æ–¥–∞
            let bmr = (10 * w) + (6.25 * h) - (5 * (2026 - a)) + (evolutionData.gender === 'm' ? 5 : -161);
            const totalKcal = Math.round(bmr * evolutionData.pal);
            document.getElementById('res-kcal-val').innerText = totalKcal;
            document.getElementById('res-water-val').innerText = (w * (evolutionData.pal > 1.4 ? 0.04 : 0.033)).toFixed(1);

            // –†–∞—Å—á–µ—Ç –ë–ñ–£
            const p = Math.round(w * 1.8);
            const f = Math.round(w * 0.9);
            const c = Math.round((totalKcal - (p * 4 + f * 9)) / 4);
            document.getElementById('p-gram').innerText = p;
            document.getElementById('f-gram').innerText = f;
            document.getElementById('c-gram').innerText = c;

            // –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Å–∞
            const lastW = evolutionData.weightHistory.values[evolutionData.weightHistory.values.length - 1];
            if (lastW !== w) {
                evolutionData.weightHistory.values.push(w);
                evolutionData.weightHistory.labels.push(new Date().toLocaleDateString('ru', {day:'numeric', month:'short'}));
                initCharts();
            }
            saveCore();
        }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–µ–π
    function updateEnergy(lv) {
        activeEnergy = lv;
        document.getElementById('lvl-low').classList.toggle('active', lv === 'low');
        document.getElementById('lvl-mid').classList.toggle('active', lv === 'mid');
        document.getElementById('lvl-high').classList.toggle('active', lv === 'high');
        renderWorkouts();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    function renderWorkouts() {
        const container = document.getElementById('workout-engine-view');
        container.innerHTML = '';
        
        evolutionLibrary.forEach(item => {
            // –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
            const isDisabled = (activeEnergy === 'low' && item.level === 'high') || (activeEnergy === 'high' && item.level === 'low');
            
            const card = document.createElement('div');
            card.className = `workout-card ${isDisabled ? 'dimmed' : ''}`;
            card.innerHTML = `
                <div class="workout-title">${item.title}</div>
                <div class="workout-stats">${evolutionData.sessionLog[item.id] || 0} –°–ï–°–°–ò–ô</div>
            `;
            card.onclick = () => { if(!isDisabled) showWorkoutDetails(item); };
            container.appendChild(card);
        });
        
        const totalSum = Object.values(evolutionData.sessionLog).reduce((a, b) => a + b, 0);
        document.getElementById('val-total-sessions').innerText = totalSum;
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
    function showWorkoutDetails(item) {
        currentTargetID = item.id;
        document.getElementById('modal-w-name').innerText = item.title;
        document.getElementById('modal-w-desc').innerText = item.text;
        document.getElementById('overlay-workout').style.display = 'flex';
    }

    function closeWorkoutModal() {
        document.getElementById('overlay-workout').style.display = 'none';
    }

    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
    function confirmSession() {
        // –£—á–µ—Ç –≤ –ª–æ–≥–∞—Ö
        evolutionData.sessionLog[currentTargetID] = (evolutionData.sessionLog[currentTargetID] || 0) + 1;
        
        // –£—á–µ—Ç –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        let dayIdx = new Date().getDay(); // 0 - –í—Å
        dayIdx = (dayIdx === 0) ? 6 : dayIdx - 1; // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ 0 - –ü–Ω
        evolutionData.activityDays[dayIdx]++;

        const total = Object.values(evolutionData.sessionLog).reduce((a, b) => a + b, 0);
        
        saveCore();
        renderWorkouts();
        closeWorkoutModal();
        initCharts();
        
        // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ Telegram
        telegramApp.HapticFeedback.notificationOccurred('success');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        checkMilestones(total);
    }

    // –°–∏—Å—Ç–µ–º–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    function checkMilestones(num) {
        let t = "", b = "";
        if (num === 8) {
            t = "–≠–¢–ê–ü: –ê–î–ê–ü–¢–ê–¶–ò–Ø";
            b = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! 8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –í–∞—à–µ —Ç–µ–ª–æ –ø—Ä–∏–≤—ã–∫–ª–æ –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º, —Å–æ–Ω —Å—Ç–∞–ª –≥–ª—É–±–∂–µ, –∞ –ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è —Å—Ç–∞–ª–æ –ª–µ–≥—á–µ. –í—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏!";
        } else if (num === 24) {
            t = "–≠–¢–ê–ü: –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–Ø";
            b = "24 –∑–∞–Ω—è—Ç–∏—è –ø–æ–∑–∞–¥–∏. –§–∞—Å—Ü–∏–∏ —Å—Ç–∞–ª–∏ –ø–ª–∞—Å—Ç–∏—á–Ω—ã–º–∏, –º—ã—à–µ—á–Ω—ã–µ –∑–∞–∂–∏–º—ã –∏—Å—á–µ–∑–ª–∏. –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–µ–≥–∫–æ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏, –∫–æ—Ç–æ—Ä—É—é –Ω–µ –æ—â—É—â–∞–ª–∏ –≥–æ–¥–∞–º–∏.";
        } else if (num === 50) {
            t = "–°–¢–ê–¢–£–°: –ú–ê–°–¢–ï–† –¢–ï–õ–ê";
            b = "50 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫! –í—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–π –º—ã—à–µ—á–Ω—ã–π –∫–æ—Ä—Å–µ—Ç. –í–∞—à–∞ –æ—Å–∞–Ω–∫–∞ –±–µ–∑—É–ø—Ä–µ—á–Ω–∞, –∞ —É—Ä–æ–≤–µ–Ω—å –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤—ã—Å–æ–∫. –í—ã –ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è.";
        } else if (num === 100) {
            t = "–≠–í–û–õ–Æ–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê";
            b = "100 –°–ï–°–°–ò–ô! –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–æ–¥–∏–ª–∏—Å—å. –í–∞—à–∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–æ–ª–æ–∂–µ –ø–∞—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞. –í—ã ‚Äî –ú–æ–Ω–æ–ª–∏—Ç –∑–¥–æ—Ä–æ–≤—å—è!";
        }

        if (t !== "") {
            document.getElementById('award-title-text').innerText = t;
            document.getElementById('award-body-text').innerText = b;
            document.getElementById('overlay-award').style.display = 'flex';
        }
    }

    // –†–∞–±–æ—Ç–∞ —Å –º–æ–¥–∞–ª–∫–æ–π PAL
    function openPalMenu() { document.getElementById('overlay-pal').style.display = 'flex'; }
    function closePalMenu() { document.getElementById('overlay-pal').style.display = 'none'; }
    function applyPal(val, name) {
        evolutionData.pal = val;
        evolutionData.palName = name;
        document.getElementById('label-pal-name').innerText = name;
        closePalMenu();
        engineSync();
        saveCore();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –°–±—Ä–æ—Å
    function saveCore() { localStorage.setItem('lady_stretch_v87_core', JSON.stringify(evolutionData)); }
    function triggerHardReset() {
        if (confirm("–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–µ—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–µ–π —ç–≤–æ–ª—é—Ü–∏–∏. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    function initCharts() {
        // –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞
        const lineCtx = document.getElementById('evolutionLineChart').getContext('2d');
        if (window.evLine) window.evLine.destroy();
        window.evLine = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: evolutionData.weightHistory.labels.slice(-7),
                datasets: [{
                    label: '–í–µ—Å',
                    data: evolutionData.weightHistory.values.slice(-7),
                    borderColor: '#ffffff',
                    borderWidth: 3,
                    pointBackgroundColor: '#ffd700',
                    pointRadius: 6,
                    tension: 0.4,
                    fill: { target: 'origin', above: 'rgba(255,215,0,0.02)' }
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { 
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: 'rgba(255,255,255,0.4)', font: { size: 10 } }
                    }
                }
            }
        });

        // –°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        const barCtx = document.getElementById('evolutionBarChart').getContext('2d');
        if (window.evBar) window.evBar.destroy();
        window.evBar = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                datasets: [{
                    data: evolutionData.activityDays,
                    backgroundColor: 'rgba(255, 215, 0, 0.7)',
                    borderRadius: 12,
                    hoverBackgroundColor: '#ffffff'
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 10 } }, grid: { display: false } },
                    y: { 
                        beginAtZero: true, 
                        ticks: { stepSize: 1, color: 'rgba(255,255,255,0.3)' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    }
                }
            }
        });
    }
</script>

</body>
</html>
