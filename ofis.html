<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lady Stretch | Evolution Elite V6.6</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.12);
            --accent: #ffffff;
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.5);
            --success: #32d74b;
            --gold: #ffd700;
            --danger: #ff3b30;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; padding: 0; 
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            /* ФОНОВАЯ КАРТИНКА: Глубокий градиент с текстурой */
            background: radial-gradient(circle at top right, #1a1a1a, #000000);
            background-attachment: fixed;
            min-height: 100vh;
            padding-bottom: 50px;
            overflow-x: hidden;
        }

        /* ПРЕЛОАДЕР */
        #preloader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 100000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease;
        }

        .laser-scanner {
            width: 100%; height: 2px;
            background: var(--gold);
            box-shadow: 0 0 20px var(--gold);
            position: absolute;
            top: -10%;
            animation: laserScan 2.5s infinite linear;
        }

        @keyframes laserScan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* ШАПКА */
        header {
            position: sticky; top: 0; width: 100%; height: 70px;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(20px);
            z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .container { max-width: 500px; margin: 0 auto; padding: 20px; }

        /* ИНПУТЫ И КНОПКИ */
        .gender-selector {
            display: flex; gap: 8px; margin-bottom: 15px;
            background: rgba(255,255,255,0.05); padding: 5px; border-radius: 15px;
        }
        .gen-btn {
            flex: 1; padding: 12px; text-align: center; font-size: 11px; font-weight: 800;
            text-transform: uppercase; border-radius: 12px; cursor: pointer; transition: 0.3s;
            color: var(--text-muted);
        }
        .gen-btn.active { background: #fff; color: #000; }

        .act-trigger {
            width: 100%; padding: 18px; background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border); border-radius: 15px;
            color: #fff; font-size: 10px; font-weight: 800; text-transform: uppercase;
            margin-bottom: 20px; cursor: pointer;
        }

        .bio-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .g-input {
            width: 100%; background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
            border-radius: 15px; padding: 15px 5px; color: #fff; text-align: center; 
            font-size: 18px; font-weight: 600;
        }

        /* КАРТОЧКИ */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .res-item { text-align: center; background: rgba(255,255,255,0.03); padding: 15px 5px; border-radius: 20px; border: 1px solid var(--glass-border); }
        .res-val { font-size: 20px; font-weight: 800; display: block; }
        .res-lbl { font-size: 9px; color: var(--text-muted); text-transform: uppercase; }

        #bmi-status { 
            font-size: 12px; padding: 15px; background: rgba(255,255,255,0.05); 
            border-radius: 18px; margin-bottom: 25px; border-left: 4px solid var(--success);
        }

        .section-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin: 30px 0 15px 5px; }

        .workout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .w-card {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            border-radius: 22px; padding: 20px; min-height: 110px;
            display: flex; flex-direction: column; justify-content: space-between;
            transition: 0.2s;
        }
        .w-card.dimmed { opacity: 0.2; filter: grayscale(1); }
        .w-name { font-size: 14px; font-weight: 700; }
        .w-count { font-size: 10px; color: var(--text-muted); }

        /* МОДАЛКА ДОСТИЖЕНИЙ (ДИПЛОМ) */
        #achieve-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200000;
            display: none; align-items: center; justify-content: center;
            padding: 20px;
        }
        .diploma {
            width: 100%; max-width: 350px; background: linear-gradient(145deg, #1a1a1a, #000);
            border: 2px solid var(--gold); border-radius: 30px; padding: 40px 25px;
            text-align: center; position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        }
        .diploma::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,215,0,0.05) 0%, transparent 70%);
        }
        .dip-rank { color: var(--gold); font-size: 10px; font-weight: 900; letter-spacing: 4px; text-transform: uppercase; margin-bottom: 10px; }
        .dip-title { font-size: 28px; font-weight: 800; margin-bottom: 20px; }
        .dip-expert { font-size: 14px; color: #ccc; line-height: 1.6; text-align: left; margin-bottom: 30px; font-style: italic; }
        .dip-btn { 
            width: 100%; padding: 18px; background: var(--gold); color: #000; 
            border: none; border-radius: 15px; font-weight: 800; cursor: pointer;
        }

        /* ОБЫЧНЫЕ МОДАЛКИ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); z-index: 5000; 
            display: none; align-items: center; justify-content: center;
        }
        .m-content { width: 90%; max-width: 400px; background: #111; border-radius: 30px; padding: 30px; border: 1px solid #333; }
        
        .chart-box { background: rgba(0,0,0,0.4); border-radius: 25px; padding: 20px; border: 1px solid var(--glass-border); }
        
        .energy-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .liquid-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            padding: 15px 5px; border-radius: 15px; text-align: center; color: #fff; font-size: 11px; font-weight: 800;
        }
        .liquid-btn.active { background: #fff; color: #000; }
    </style>
</head>
<body>

<div id="preloader">
    <div class="laser-scanner"></div>
    <div style="text-align:center; z-index: 10;">
        <div style="font-size:24px; letter-spacing:10px; font-weight:100;">LADY STRETCH</div>
        <div style="font-size:8px; color:var(--gold); letter-spacing:4px; margin-top:10px;">MONOLITH EVOLUTION V6.6</div>
    </div>
</div>

<header>
    <div style="font-weight:800; font-size:16px;">LADY STRETCH</div>
    <div style="text-align: right;">
        <span id="head-total" style="font-size:24px; font-weight:200; display: block;">0</span>
        <span style="font-size:8px; color:var(--text-muted); text-transform: uppercase;">Сессий</span>
    </div>
</header>

<div class="container">
    <div class="section-label">Профиль</div>
    <div class="gender-selector">
        <div class="gen-btn active" id="gen-m" onclick="handleGender('m')">Мужчина</div>
        <div class="gen-btn" id="gen-f" onclick="handleGender('f')">Женщина</div>
    </div>
    
    <button class="act-trigger" onclick="toggleModal('act-modal', true)">
        Активность: <span id="act-label" style="color:var(--gold)">Средняя</span>
    </button>

    <div class="bio-row">
        <input type="number" id="w-in" class="g-input" placeholder="Вес" oninput="runCalculations()">
        <input type="number" id="h-in" class="g-input" placeholder="Рост" oninput="runCalculations()">
        <input type="number" id="a-in" class="g-input" placeholder="Лет" oninput="runCalculations()">
    </div>
    
    <div class="results-grid">
        <div class="res-item"><span class="res-val" id="bmi-val">--</span><span class="res-lbl">ИМТ</span></div>
        <div class="res-item"><span class="res-val" id="h2o-val">--</span><span class="res-lbl">Вода л.</span></div>
        <div class="res-item"><span class="res-val" id="bmr-val">--</span><span class="res-lbl">Ккал</span></div>
    </div>
    <div id="bmi-status">Ждем ваших данных...</div>

    <div class="section-label">Ваш ресурс сегодня</div>
    <div class="energy-row">
        <div class="liquid-btn" id="e-low" onclick="changeEnergy('low')">СПАД</div>
        <div class="liquid-btn active" id="e-mid" onclick="changeEnergy('mid')">БАЛАНС</div>
        <div class="liquid-btn" id="e-high" onclick="changeEnergy('high')">ПИК</div>
    </div>

    <div class="section-label">Программы тренировок</div>
    <div class="workout-grid" id="w-grid"></div>

    <div class="section-label">Аналитика веса</div>
    <div class="chart-box"><canvas id="wChart" height="140"></canvas></div>
    
    <center><button style="margin-top:40px; background:none; border:none; color:var(--danger); font-size:10px; font-weight:800; text-transform:uppercase; letter-spacing:1px;" onclick="resetAllData()">Сбросить всё</button></center>
</div>

<div id="w-modal" class="modal-overlay" onclick="toggleModal('w-modal', false)">
    <div class="m-content" onclick="event.stopPropagation()">
        <h2 id="m-title" style="margin-bottom:15px;"></h2>
        <p id="m-desc" style="font-size:14px; color:#aaa; line-height:1.6; margin-bottom:25px; border-left:2px solid #fff; padding-left:15px;"></p>
        <button class="dip-btn" onclick="confirmSession()">ПОДТВЕРДИТЬ СЕССИЮ</button>
    </div>
</div>

<div id="act-modal" class="modal-overlay" onclick="toggleModal('act-modal', false)">
    <div class="m-content" onclick="event.stopPropagation()">
        <div style="margin-bottom:15px; font-weight:800;">ВАША АКТИВНОСТЬ</div>
        <div style="display:grid; gap:10px;">
            <button class="act-trigger" style="margin:0; text-align:left;" onclick="setActivity(1.2, 'Низкая')">НИЗКАЯ (Сидячая)</button>
            <button class="act-trigger" style="margin:0; text-align:left;" onclick="setActivity(1.55, 'Средняя')">СРЕДНЯЯ (3-4 раза в нед.)</button>
            <button class="act-trigger" style="margin:0; text-align:left;" onclick="setActivity(1.9, 'Высокая')">ВЫСОКАЯ (Каждый день)</button>
        </div>
    </div>
</div>

<div id="achieve-modal">
    <div class="diploma">
        <div class="dip-rank" id="dip-rank">НОВЫЙ СТАТУС</div>
        <div class="dip-title" id="dip-title">ГРАЦИЯ</div>
        <div class="dip-expert" id="dip-expert"></div>
        <button class="dip-btn" onclick="closeAchievement()">ПРИНЯТЬ И ПРОДОЛЖИТЬ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let db = JSON.parse(localStorage.getItem('monolith_v6_6')) || {
        gender: 'f', weight: '', height: '', age: 30, pal: 1.55, palName: 'Средняя',
        logs: {}, dates: [], weightHistory: {v: [], d: []},
        shownAchievements: []
    };

    const workouts = [
        { id:'mfr', n:'МФР Терапия', type:'low', desc:'Снятие фасциальных зажимов. Ощущение легкости в теле уже после первого сеанса.' },
        { id:'back', n:'Здоровая Спина', type:'low', desc:'Коррекция осанки и укрепление мышечного корсета. Забудьте о дискомфорте.' },
        { id:'sky', n:'Sky Stretch', type:'mid', desc:'Растяжка в гамаках. Декомпрессия позвоночника и чувство полета.' },
        { id:'split', n:'Шпагат', type:'mid', desc:'Целевая работа над гибкостью. Плавный и безопасный прогресс.' },
        { id:'tabata', n:'Табата', type:'high', desc:'Жиросжигающий интенсив. Максимальный метаболический отклик.' },
        { id:'sculpt', n:'Body Sculpt', type:'high', desc:'Силовой рельеф и тонус мышц. Создаем идеальные линии.' }
    ];

    const expertAdvice = {
        8: { rank: "ДЕБЮТ", title: "НЕЖНОСТЬ", text: "8 занятий — это нейромышечный прорыв. Мозг перестал воспринимать растяжку как стресс. Теперь каждая минута в зале работает на омоложение ваших клеток. Почувствуйте, как уходит отечность!" },
        30: { rank: "СТАТУС", title: "ГРАЦИЯ", text: "30 сессий. Глубокая фасциальная перестройка. Ваши движения стали плавными, а осанка — королевской. Обмен веществ ускорился на 15%, даже когда вы спите." },
        60: { rank: "ЭЛИТА", title: "ДИВА", text: "60 занятий. Вы изменили архитектуру своего тела. Мышечная память зафиксировала новый стандарт гибкости. Уровень гормона радости стабильно выше нормы!" },
        100: { rank: "ТРИУМФ", title: "МУЗА", text: "100 тренировок! Вы — эталон Lady Stretch. Биологический возраст вашего тела сейчас на 5-7 лет меньше паспортного. Вы сияете изнутри!" },
        150: { rank: "ЛЕГЕНДА", title: "МОНОЛИТ", text: "150 сессий. Совершенство достигнуто. Ваша дисциплина и тело стали единым целым. Это полная трансформация жизни через движение." }
    };

    let curEnergy = 'mid';
    let curW = null;

    window.onload = () => {
        setTimeout(() => { document.getElementById('preloader').style.opacity = '0'; 
        setTimeout(() => document.getElementById('preloader').style.display = 'none', 800); }, 2500);

        document.getElementById('w-in').value = db.weight;
        document.getElementById('h-in').value = db.height;
        document.getElementById('a-in').value = db.age;
        document.getElementById('act-label').innerText = db.palName;
        handleGender(db.gender);
        renderWorkouts();
        updateCharts();
        runCalculations();
    };

    function handleGender(g) {
        db.gender = g;
        document.getElementById('gen-m').classList.toggle('active', g === 'm');
        document.getElementById('gen-f').classList.toggle('active', g === 'f');
        runCalculations();
    }

    function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }

    function setActivity(val, name) {
        db.pal = val; db.palName = name;
        document.getElementById('act-label').innerText = name;
        toggleModal('act-modal', false);
        runCalculations();
    }

    function runCalculations() {
        const w = parseFloat(document.getElementById('w-in').value);
        const h = parseFloat(document.getElementById('h-in').value);
        const a = parseInt(document.getElementById('a-in').value);
        if(!w || !h || !a) return;

        db.weight = w; db.height = h; db.age = a;
        const bmi = (w / ((h/100)**2)).toFixed(1);
        document.getElementById('bmi-val').innerText = bmi;

        let bmr = (10 * w) + (6.25 * h) - (5 * a) + (db.gender === 'm' ? 5 : -161);
        document.getElementById('bmr-val').innerText = Math.round(bmr * db.pal);
        document.getElementById('h2o-val').innerText = (w * 0.033).toFixed(1);

        const st = document.getElementById('bmi-status');
        if(bmi < 18.5) { st.innerText = "Дефицит массы. Добавьте в рацион белок и силовые тренировки Body Sculpt."; st.style.borderLeftColor = "var(--gold)"; }
        else if(bmi < 25) { st.innerText = "Идеальный ИМТ! Вы в прекрасной форме, поддерживайте её регулярным стретчингом."; st.style.borderLeftColor = "var(--success)"; }
        else { st.innerText = "Мягкий избыток веса. Рекомендуем Табату и МФР для лимфодренажа."; st.style.borderLeftColor = "var(--danger)"; }

        if(db.weightHistory.v[db.weightHistory.v.length-1] !== w) {
            db.weightHistory.v.push(w);
            db.weightHistory.d.push(new Date().toLocaleDateString('ru',{day:'numeric',month:'short'}));
            updateCharts();
        }
        save();
    }

    function changeEnergy(type) {
        curEnergy = type;
        document.querySelectorAll('.liquid-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('e-'+type).classList.add('active');
        renderWorkouts();
    }

    function renderWorkouts() {
        const grid = document.getElementById('w-grid');
        grid.innerHTML = '';
        workouts.forEach(w => {
            const isDim = (curEnergy === 'low' && w.type === 'high') || (curEnergy === 'high' && w.type === 'low');
            const card = document.createElement('div');
            card.className = `w-card ${isDim ? 'dimmed' : ''}`;
            card.innerHTML = `<div class="w-name">${w.n}</div><div class="w-count">${db.logs[w.id] || 0} занятий</div>`;
            card.onclick = () => { if(!isDim) { curW = w; document.getElementById('m-title').innerText = w.n; document.getElementById('m-desc').innerText = w.desc; toggleModal('w-modal', true); }};
            grid.appendChild(card);
        });
        const total = Object.values(db.logs).reduce((a,b)=>a+b, 0);
        document.getElementById('head-total').innerText = total;
    }

    function confirmSession() {
        db.logs[curW.id] = (db.logs[curW.id] || 0) + 1;
        db.dates.push(Date.now());
        const total = Object.values(db.logs).reduce((a,b)=>a+b, 0);
        save();
        renderWorkouts();
        toggleModal('w-modal', false);
        tg.HapticFeedback.notificationOccurred('success');
        
        if(expertAdvice[total] && !db.shownAchievements.includes(total)) {
            showAchievement(total);
        }
    }

    function showAchievement(num) {
        const data = expertAdvice[num];
        document.getElementById('dip-rank').innerText = data.rank;
        document.getElementById('dip-title').innerText = data.title;
        document.getElementById('dip-expert').innerText = data.text;
        document.getElementById('achieve-modal').style.display = 'flex';
        db.shownAchievements.push(num);
        save();
    }

    function closeAchievement() { document.getElementById('achieve-modal').style.display = 'none'; }

    function updateCharts() {
        const ctx = document.getElementById('wChart').getContext('2d');
        if(window.wChartObj) window.wChartObj.destroy();
        window.wChartObj = new Chart(ctx, {
            type: 'line',
            data: {
                labels: db.weightHistory.d.slice(-7),
                datasets: [{ data: db.weightHistory.v.slice(-7), borderColor: '#fff', borderWidth: 2, tension: 0.4, fill: true, backgroundColor: 'rgba(255,255,255,0.05)' }]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });
    }

    function save() { localStorage.setItem('monolith_v6_6', JSON.stringify(db)); }
    function resetAllData() { if(confirm("Сбросить все данные?")) { localStorage.removeItem('monolith_v6_6'); location.reload(); } }
</script>

</body>
</html>
