<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monolith V6.5 Elite | FULL SYSTEM</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    
<style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.22);
            --accent: #ffffff;
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.55);
            --success: #32d74b;
            --gold: #ffd700;
            --danger: #ff3b30;
            --neon-glow: 0 0 20px rgba(255, 255, 255, 0.15);
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; padding: 0; 
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            background: #000 url('bg.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            padding-bottom: 120px;
            overflow-x: hidden;
        }

        /* КИНЕМАТОГРАФИЧНЫЙ ПРЕДЗАГРУЗЧИК (LOGO INTRO) */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .intro-title {
            font-weight: 900; letter-spacing: 20px; font-size: 30px; color: #fff;
            text-transform: uppercase; animation: cinematic 4s ease-in-out forwards;
            text-align: center;
        }
        @keyframes cinematic {
            0% { opacity: 0; letter-spacing: 5px; transform: scale(0.8); filter: blur(15px); }
            45% { opacity: 1; letter-spacing: 20px; transform: scale(1); filter: blur(0); }
            75% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0; transform: translateY(-40px) scale(1.1); }
        }

        header {
            position: sticky; top: 0; width: 100%; height: 90px;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(35px); -webkit-backdrop-filter: blur(35px);
            z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
            border-bottom: 1px solid var(--glass-border);
        }

        .container { max-width: 500px; margin: 0 auto; padding: 25px; }

        /* ЗАГОЛОВКИ БЛОКОВ - МАКСИМАЛЬНО ЖИРНЫЕ */
        .section-label { 
            font-size: 14px; font-weight: 900; text-transform: uppercase; letter-spacing: 3px; 
            color: #fff; margin: 50px 0 25px 5px; display: block;
        }

        /* ЭФФЕКТ СТЕКЛЯННОЙ ЛИНЗЫ И КРОМКИ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4), inset 0 0 15px rgba(255,255,255,0.05);
            overflow: hidden;
            transition: 0.3s;
        }
        /* Световая кромка */
        .glass-panel::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }

        /* ВЫБОР ПОЛА */
        .gender-selector { display: flex; gap: 15px; margin-bottom: 20px; }
        .gen-btn {
            flex: 1; padding: 20px; text-align: center; font-size: 13px; font-weight: 900;
            text-transform: uppercase; border-radius: 20px; cursor: pointer; transition: 0.4s;
            color: var(--text-muted); background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
        }
        .gen-btn.active { 
            background: #fff; color: #000; border-color: #fff; 
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
        }

        /* ТРИГГЕР АКТИВНОСТИ */
        .act-trigger {
            width: 100%; padding: 24px; font-size: 12px; font-weight: 900; text-transform: uppercase;
            letter-spacing: 2px; color: #fff; margin-bottom: 35px; cursor: pointer; text-align: center;
        }

        /* ВВОД ДАННЫХ */
        .bio-row { display: flex; gap: 15px; margin-bottom: 35px; }
        .g-input-wrap { flex: 1; }
        .g-input {
            width: 100%; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border);
            border-radius: 22px; padding: 24px 5px; color: #fff; text-align: center; 
            font-size: 24px; font-weight: 700; outline: none; transition: 0.3s;
        }
        .g-input:focus { background: rgba(255,255,255,0.15); border-color: #fff; }

        /* СЕТКА ОСНОВНЫХ РЕЗУЛЬТАТОВ */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .res-item { text-align: center; padding: 25px 10px; border-radius: 28px; }
        .res-val { font-size: 28px; font-weight: 900; display: block; color: #fff; margin-bottom: 5px; }
        .res-lbl { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        
        /* ЭКСПЕРТНОЕ ЗАКЛЮЧЕНИЕ (ИМТ) */
        #bmi-status { 
            font-size: 15px; line-height: 1.7; padding: 25px;
            background: rgba(255,255,255,0.07); border-radius: 28px; margin-bottom: 40px;
            border-left: 8px solid var(--success); transition: 0.5s;
        }

        /* НУТРИЦИОЛОГИЯ: БЖУ */
        .pfc-box { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 45px; }
        .pfc-item { padding: 22px 10px; border-radius: 25px; text-align: center; }
        .pfc-val { font-size: 22px; font-weight: 900; display: block; color: var(--gold); }
        .pfc-lbl { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-top: 5px; }

        /* ВЫБОР ЭНЕРГИИ */
        .energy-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .liquid-btn {
            width: 100%; padding: 22px 0; border-radius: 25px; text-align: center; color: #fff;
            font-size: 13px; font-weight: 900; text-transform: uppercase; transition: 0.4s;
        }
        .liquid-btn.active { background: #fff; color: #000; box-shadow: 0 15px 30px rgba(255,255,255,0.25); }

        /* КАРТОЧКИ ТРЕНИРОВОК */
        .workout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
        .w-card {
            padding: 30px 20px; min-height: 150px; display: flex; flex-direction: column; justify-content: space-between;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); cursor: pointer;
        }
        .w-card:active { transform: scale(0.96); }
        .w-card.dimmed { opacity: 0.15; filter: grayscale(1); pointer-events: none; }
        .w-name { font-size: 17px; font-weight: 800; line-height: 1.3; }
        .w-count { font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin-top: 10px; }

        /* БЛОК ГРАФИКОВ */
        .chart-container { padding: 25px; margin-top: 20px; }

        /* МОДАЛЬНЫЕ ОКНА */
        #modal, #act-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); backdrop-filter: blur(50px); z-index: 5000; 
            display: none; align-items: center; justify-content: center;
        }
        .m-content { 
            width: 90%; max-width: 420px; background: #000; border: 1px solid #333; 
            border-radius: 50px; padding: 45px; text-align: center;
        }
        .m-title { font-size: 30px; font-weight: 900; margin-bottom: 25px; }
        .m-desc { 
            font-size: 16px; color: #bbb; line-height: 1.8; text-align: left;
            border-left: 5px solid #fff; padding-left: 25px; margin-bottom: 40px;
        }
        
        .act-option {
            width: 100%; padding: 28px; background: rgba(255,255,255,0.06); border-radius: 30px;
            margin-bottom: 18px; border: 1px solid var(--glass-border); color: #fff; text-align: left;
            cursor: pointer;
        }
        .act-option:active { background: #fff; color: #000; }

        /* КНОПКА СБРОСА */
        .btn-reset {
            background: rgba(255, 59, 48, 0.1); border: 2.5px solid var(--danger); 
            color: var(--danger); padding: 22px 55px; border-radius: 40px; 
            font-size: 14px; font-weight: 900; text-transform: uppercase; 
            margin: 70px 0; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="preloader"><div class="intro-title">Evolution Elite</div></div>

<header>
    <div style="font-weight:900; font-size:22px; letter-spacing:2px;">LADY STRETCH</div>
    <div style="text-align: right;">
        <span id="head-total" style="font-size:36px; font-weight:100; display:block; line-height:1;">0</span>
        <span style="font-size:9px; color:var(--text-muted); text-transform:uppercase;">Sessions</span>
    </div>
</header>

<div class="container">
    
    <div class="section-label">Ваш Профиль и Активность</div>
    
    <div class="gender-selector">
        <div class="gen-btn active" id="gen-m" onclick="updateGender('m')">Мужчина</div>
        <div class="gen-btn" id="gen-f" onclick="updateGender('f')">Женщина</div>
    </div>
    
    <div class="act-trigger glass-panel" onclick="showActMenu()">
        Ритм: <span id="act-label" style="color:var(--gold)">Средняя активность</span>
    </div>

    <div class="bio-row">
        <div class="g-input-wrap"><input type="number" id="w-in" class="g-input glass-panel" placeholder="Вес" oninput="calculate()"></div>
        <div class="g-input-wrap"><input type="number" id="h-in" class="g-input glass-panel" placeholder="Рост" oninput="calculate()"></div>
        <div class="g-input-wrap"><input type="number" id="a-in" class="g-input glass-panel" placeholder="Лет" oninput="calculate()"></div>
    </div>
    
    <div class="results-grid">
        <div class="res-item glass-panel"><span class="res-val" id="bmi-val">--</span><span class="res-lbl">ИМТ</span></div>
        <div class="res-item glass-panel"><span class="res-val" id="h2o-val">--</span><span class="res-lbl">Вода (л)</span></div>
        <div class="res-item glass-panel"><span class="res-val" id="bmr-val">--</span><span class="res-lbl">Ккал/день</span></div>
    </div>
    
    <div id="bmi-status" class="glass-panel">Введите параметры для запуска ИИ-анализа состояния вашего организма...</div>

    <div class="section-label">Нутрициология: План на 24 часа</div>
    <div class="pfc-box">
        <div class="pfc-item glass-panel">
            <span class="pfc-val" id="p-val">--</span>
            <span class="pfc-lbl">Белки (г)</span>
        </div>
        <div class="pfc-item glass-panel">
            <span class="pfc-val" id="f-val">--</span>
            <span class="pfc-lbl">Жиры (г)</span>
        </div>
        <div class="pfc-item glass-panel">
            <span class="pfc-val" id="c-val">--</span>
            <span class="pfc-lbl">Углеводы (г)</span>
        </div>
    </div>

    <div class="section-label">Ваш Ресурс сегодня</div>
    <div class="energy-row">
        <div class="e-col" onclick="setEnergy('low')">
            <div class="liquid-btn glass-panel" id="e-low">Спад</div>
        </div>
        <div class="e-col" onclick="setEnergy('mid')">
            <div class="liquid-btn glass-panel active" id="e-mid">Баланс</div>
        </div>
        <div class="e-col" onclick="setEnergy('high')">
            <div class="liquid-btn glass-panel" id="e-high">Пик</div>
        </div>
    </div>

    <div class="section-label">Протоколы Lady Stretch</div>
    <div class="workout-grid" id="w-grid"></div>

    <div class="section-label">Динамика прогресса</div>
    <div class="glass-panel chart-container">
        <canvas id="mainChart" height="180"></canvas>
    </div>
    <div class="section-label">Активность за неделю</div>
    <div class="glass-panel chart-container">
        <canvas id="activityChart" height="150"></canvas>
    </div>

    <center><button class="btn-reset" onclick="fullReset()">Сбросить систему</button></center>
</div>

<div id="act-modal" onclick="hideActMenu()">
    <div class="m-content" onclick="event.stopPropagation()">
        <div class="m-title">Ваша активность?</div>
        <div class="act-option" onclick="setPAL(1.2, 'Низкая активность')">
            <span style="font-weight:900; font-size:18px; display:block;">НИЗКАЯ</span>
            <span style="font-size:12px; color:#888;">Сидячий образ жизни, шаги менее 5000 в день.</span>
        </div>
        <div class="act-option" onclick="setPAL(1.55, 'Средняя активность')">
            <span style="font-weight:900; font-size:18px; display:block;">СРЕДНЯЯ (LADY STRETCH)</span>
            <span style="font-size:12px; color:#888;">2-3 тренировки в неделю + активные прогулки.</span>
        </div>
        <div class="act-option" onclick="setPAL(1.9, 'ВЫСОКАЯ')">
            <span style="font-weight:900; font-size:18px; display:block;">ВЫСОКАЯ / АТЛЕТ</span>
            <span style="font-size:12px; color:#888;">Ежедневный интенсивный спорт или тяжелый труд.</span>
        </div>
    </div>
</div>

<div id="modal" onclick="hideWModal()">
    <div class="m-content" onclick="event.stopPropagation()">
        <div id="m-title" class="m-title"></div>
        <div id="m-desc" class="m-desc"></div>
        <button style="width:100%; padding:25px; background:#fff; color:#000; border:none; border-radius:30px; font-weight:900; font-size:16px;" onclick="logSession()">ПОДТВЕРДИТЬ ТРЕНИРОВКУ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // БАЗА ДАННЫХ МОНОЛИТА
    let user = JSON.parse(localStorage.getItem('monolith_6_5_full_pro')) || {
        gender: 'm',
        weight: '',
        height: '',
        age: 44,
        pal: 1.55,
        palName: 'Средняя активность',
        logs: {},
        dates: [],
        weightHistory: { v: [], d: [] }
    };

    // ПОЛНЫЙ ПЕРЕЧЕНЬ НАПРАВЛЕНИЙ
    const workoutDatabase = [
        { id:'mfr', n:'МФР Терапия', type:'low', desc:'Проработка триггерных точек. Устранение мышечных узлов, улучшение кровотока и восстановление тканей.' },
        { id:'back', n:'Здоровая спина', type:'low', desc:'Коррекция осанки, укрепление глубокого мышечного корсета и декомпрессия позвонков.' },
        { id:'yoga', n:'Йога Релакс', type:'low', desc:'Глубокое дыхание и статические асаны для снижения уровня стресса и кортизола.' },
        { id:'str', n:'Стретчинг', type:'low', desc:'Классическая растяжка для улучшения эластичности связок и свободы движений.' },
        { id:'sky', n:'Sky Stretch', type:'mid', desc:'Тренировка в гамаках. Использование гравитации для вытяжения позвоночника и новых ощущений.' },
        { id:'split', n:'Шпагат', type:'mid', desc:'Специализированная работа на гибкость нижней части тела. Безопасное достижение результата.' },
        { id:'pil', n:'Пилатес', type:'mid', desc:'Система упражнений на контроль тела, концентрацию и укрепление мышц-стабилизаторов.' },
        { id:'circ', n:'Круговая', type:'mid', desc:'Комплексная нагрузка на все группы мышц в умеренном темпе для тонуса и выносливости.' },
        { id:'tab', n:'Талата', type:'high', desc:'Взрывной интервальный тренинг. Максимальное сжигание калорий и разгон метаболизма.' },
        { id:'scu', n:'Body Sculpt', type:'high', desc:'Силовая работа с малым оборудованием для создания четкого мышечного рельефа.' },
        { id:'trx', n:'TRX Петли', type:'high', desc:'Функциональный тренинг с весом собственного тела. Развивает баланс и мощный кор.' },
        { id:'glute', n:'Ягодицы + Пресс', type:'high', desc:'Акцентированная проработка целевых зон для создания идеального силуэта.' }
    ];

    let currentEnergy = 'mid';
    let activeWId = null;

    window.onload = () => {
        // Убираем интро
        setTimeout(() => {
            document.getElementById('preloader').style.opacity = '0';
            setTimeout(() => document.getElementById('preloader').style.display='none', 1200);
        }, 3000);

        // Инициализация полей
        document.getElementById('w-in').value = user.weight;
        document.getElementById('h-in').value = user.height;
        document.getElementById('a-in').value = user.age;
        document.getElementById('act-label').innerText = user.palName;
        
        updateGender(user.gender);
        renderWorkouts();
        updateCharts();
        calculate();
    };

    function updateGender(g) {
        user.gender = g;
        document.getElementById('gen-m').classList.toggle('active', g === 'm');
        document.getElementById('gen-f').classList.toggle('active', g === 'f');
        calculate();
        save();
    }

    function showActMenu() { document.getElementById('act-modal').style.display = 'flex'; }
    function hideActMenu() { document.getElementById('act-modal').style.display = 'none'; }
    
    function setPAL(val, name) {
        user.pal = val;
        user.palName = name;
        document.getElementById('act-label').innerText = name;
        hideActMenu();
        calculate();
        save();
    }

    function calculate() {
        const w = parseFloat(document.getElementById('w-in').value);
        const h = parseFloat(document.getElementById('h-in').value);
        const a = parseInt(document.getElementById('a-in').value);

        if (w > 0 && h > 0 && a > 0) {
            user.weight = w; user.height = h; user.age = a;
            
            // ИМТ
            const bmi = (w / ((h/100)**2)).toFixed(1);
            document.getElementById('bmi-val').innerText = bmi;

            // СТАТУС И ТЕКСТ ПО САХАРУ
            let status = "";
            let color = "var(--success)";
            
            if (user.pal <= 1.2) {
                if (bmi > 25) { 
                    status = `ИМТ ${bmi}: Внимание! При вашем ритме жизни это риск застоя. Исключите быстрые углеводы и ограничьте сахар на 90%. Начните с МФР!`; 
                    color = "var(--danger)";
                } else { status = "Вес в норме, но без тренировок ткани теряют эластичность. Попробуйте Sky Stretch."; }
            } else if (user.pal >= 1.9) {
                status = bmi > 26 ? `ИМТ ${bmi}: Отличный атлетический показатель. Требуется больше белков!` : "Высокий метаболизм. Следите за минеральным балансом.";
            } else {
                status = bmi < 25 ? "Идеальный баланс. Вы в отличной форме для Lady Stretch!" : "Небольшой излишек. Рекомендуем Табату и жесткий контроль сахара.";
            }
            const stEl = document.getElementById('bmi-status');
            stEl.innerText = status; stEl.style.borderLeftColor = color;

            // ККАЛ (МИФФЛИН)
            let bmr = (10 * w) + (6.25 * h) - (5 * a) + (user.gender === 'm' ? 5 : -161);
            const totalKcal = Math.round(bmr * user.pal);
            document.getElementById('bmr-val').innerText = totalKcal;

            // ВОДА
            document.getElementById('h2o-val').innerText = (w * (user.pal > 1.5 ? 0.04 : 0.033)).toFixed(1);

            // БЖУ (НА 24 ЧАСА)
            const p = Math.round(w * (user.pal > 1.5 ? 2.0 : 1.5));
            const f = Math.round(w * 0.9);
            const c = Math.round((totalKcal - (p * 4 + f * 9)) / 4);
            
            document.getElementById('p-val').innerText = p;
            document.getElementById('f-val').innerText = f;
            document.getElementById('c-val').innerText = c;

            // История веса
            if (user.weightHistory.v[user.weightHistory.v.length-1] !== w) {
                user.weightHistory.v.push(w);
                user.weightHistory.d.push(new Date().toLocaleDateString('ru',{day:'numeric',month:'short'}));
                updateCharts();
            }
            save();
        }
    }

    function setEnergy(type) {
        currentEnergy = type;
        document.querySelectorAll('.liquid-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('e-' + type).classList.add('active');
        renderWorkouts();
    }

    function renderWorkouts() {
        const grid = document.getElementById('w-grid');
        grid.innerHTML = '';
        workoutDatabase.forEach(w => {
            const isDimmed = (currentEnergy === 'low' && w.type === 'high') || (currentEnergy === 'high' && w.type === 'low');
            const card = document.createElement('div');
            card.className = `w-card glass-panel ${isDimmed ? 'dimmed' : ''}`;
            card.innerHTML = `
                <div class="w-name">${w.n}</div>
                <div class="w-count">${user.logs[w.id] || 0} занятий</div>
            `;
            card.onclick = () => { if(!isDimmed) showWModal(w); };
            grid.appendChild(card);
        });
        document.getElementById('head-total').innerText = Object.values(user.logs).reduce((a,b)=>a+b,0);
    }

    function showWModal(w) {
        activeWId = w.id;
        document.getElementById('m-title').innerText = w.n;
        document.getElementById('m-desc').innerText = w.desc;
        document.getElementById('modal').style.display = 'flex';
    }
    
    function hideWModal() { document.getElementById('modal').style.display = 'none'; }

    function logSession() {
        user.logs[activeWId] = (user.logs[activeWId] || 0) + 1;
        user.dates.push(Date.now());
        save();
        renderWorkouts();
        updateCharts();
        hideWModal();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function updateCharts() {
        // Вес
        const ctxW = document.getElementById('mainChart').getContext('2d');
        if (window.wChartObj) window.wChartObj.destroy();
        window.wChartObj = new Chart(ctxW, {
            type: 'line',
            data: {
                labels: user.weightHistory.d.slice(-10),
                datasets: [{
                    data: user.weightHistory.v.slice(-10),
                    borderColor: '#fff',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: false,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: { plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{grid:{color:'rgba(255,255,255,0.1)'}, ticks:{color:'#666'}}} }
        });

        // Активность
        const actData = [0,0,0,0,0,0,0];
        const now = Date.now();
        user.dates.forEach(t => { if(now-t < 604800000) actData[new Date(t).getDay()]++; });
        const ctxA = document.getElementById('activityChart').getContext('2d');
        if (window.actChartObj) window.actChartObj.destroy();
        window.actChartObj = new Chart(ctxA, {
            type: 'bar',
            data: {
                labels: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
                datasets: [{ data: actData, backgroundColor: 'rgba(50, 215, 75, 0.7)', borderRadius: 10 }]
            },
            options: { plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#666'}}, y:{display:false}} }
        });
    }

    function save() { localStorage.setItem('monolith_6_5_full_pro', JSON.stringify(user)); }
    
    function fullReset() {
        if(confirm("Николай, это удалит все данные профиля и тренировок. Уверены?")) {
            localStorage.removeItem('monolith_6_5_full_pro');
            location.reload();
        }
    }
</script>
</body>
</html>
