<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lady Stretch | Monolith Absolute V7.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* АРХИТЕКТУРА СТИЛЯ: ПРЕМИАЛЬНЫЙ МИНИМАЛИЗМ 
           Цвета: Глубокий антрацит, шампанское золото, матовое стекло
        */
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #F3E5AB;
            --gold-dark: #996515;
            --background-deep: #030303;
            --glass-background: rgba(255, 255, 255, 0.02);
            --glass-border-light: rgba(255, 255, 255, 0.15);
            --glass-border-dark: rgba(255, 255, 255, 0.05);
            --text-main: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.5);
            --accent-danger: #FF3B30;
            --accent-success: #34C759;
            --shadow-premium: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; padding: 0; 
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--background-deep);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(212, 175, 55, 0.07), transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(255, 255, 255, 0.02), transparent 50%);
            background-attachment: fixed;
            padding-bottom: 140px;
        }

        /* АНИМИРОВАННЫЙ ПРЕЛОАДЕР */
        #monolith-preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 99999; display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 1.5s ease-out;
        }
        .preloader-title { font-size: 28px; font-weight: 100; letter-spacing: 15px; margin-bottom: 15px; text-transform: uppercase; }
        .preloader-subtitle { font-size: 10px; font-weight: 800; color: var(--gold-primary); letter-spacing: 6px; text-transform: uppercase; }
        .preloader-line { width: 1px; height: 0; background: var(--gold-primary); margin-top: 40px; animation: lineGrow 2s forwards cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes lineGrow { to { height: 80px; opacity: 0; } }

        /* ВЕРХНЯЯ ПАНЕЛЬ СТАТУСА */
        header {
            position: sticky; top: 0; width: 100%; height: 90px;
            background: rgba(3, 3, 3, 0.7); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            z-index: 999; display: flex; align-items: center; justify-content: space-between; 
            padding: 0 30px; border-bottom: 1px solid var(--glass-border-dark);
        }
        .header-logo { font-weight: 200; font-size: 17px; letter-spacing: 5px; text-transform: uppercase; }
        .header-total-sessions { text-align: right; }
        .sessions-value { font-size: 28px; font-weight: 200; display: block; line-height: 1; color: var(--gold-primary); }
        .sessions-label { font-size: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); }

        .app-container { max-width: 550px; margin: 0 auto; padding: 25px; }

        .ui-label { 
            font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 4px; 
            color: var(--text-secondary); margin: 40px 0 20px 10px; display: block;
        }

        /* ГОРЯЧИЕ КНОПКИ И ПЕРЕКЛЮЧАТЕЛИ */
        .glass-panel {
            background: var(--glass-background);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border-dark);
            border-top: 1px solid var(--glass-border-light);
            border-left: 1px solid var(--glass-border-light);
            border-radius: 30px;
            padding: 25px;
            box-shadow: var(--shadow-premium);
            margin-bottom: 20px;
        }

        .tab-selector { display: flex; gap: 10px; background: rgba(0,0,0,0.3); padding: 6px; border-radius: 20px; }
        .tab-option {
            flex: 1; padding: 15px; text-align: center; font-size: 11px; font-weight: 700;
            text-transform: uppercase; border-radius: 16px; cursor: pointer; transition: all 0.4s ease;
            color: var(--text-secondary);
        }
        .tab-option.active { background: #fff; color: #000; box-shadow: 0 10px 20px rgba(255,255,255,0.1); }

        /* ИНПУТЫ И БИОМЕТРИЯ */
        .input-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .input-box { text-align: center; }
        .input-box-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; display: block; }
        .input-field {
            width: 100%; background: transparent; border: none; color: #fff;
            font-size: 26px; font-weight: 200; text-align: center; outline: none;
        }

        /* ЭКСПЕРТНЫЕ ПОКАЗАТЕЛИ */
        .metric-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .metric-card { text-align: center; padding: 25px 10px; }
        .metric-card-value { font-size: 26px; font-weight: 200; display: block; margin-bottom: 5px; }
        .metric-card-label { font-size: 9px; color: var(--gold-primary); text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }

        .expert-advice-panel {
            padding: 25px; font-size: 14px; font-weight: 300; line-height: 1.8; color: #e0e0e0;
            border-left: 4px solid var(--gold-primary); background: rgba(212, 175, 55, 0.03);
            border-radius: 0 20px 20px 0; margin-bottom: 40px;
        }

        /* ТРЕНИРОВКИ: СЕТКА И КАРТОЧКИ */
        .workout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .workout-item {
            min-height: 160px; padding: 30px 20px; display: flex; flex-direction: column; justify-content: space-between;
            transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1); cursor: pointer; position: relative; overflow: hidden;
        }
        .workout-item:active { transform: scale(0.95) translateY(5px); }
        .workout-item.disabled { opacity: 0.1; filter: grayscale(1); pointer-events: none; }
        
        .workout-item-title { font-size: 15px; font-weight: 600; line-height: 1.4; letter-spacing: -0.2px; }
        .workout-item-stats { font-size: 10px; color: var(--gold-primary); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        
        /* ГРАФИКИ АНАЛИТИКИ */
        .chart-wrapper { min-height: 220px; padding: 30px; }

        /* МОДАЛЬНЫЕ ОКНА: СТЕКЛЯННЫЙ СТИЛЬ */
        .modal-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(50px); -webkit-backdrop-filter: blur(50px);
            z-index: 10000; display: none; align-items: center; justify-content: center; padding: 30px;
        }
        .modal-window { width: 100%; max-width: 450px; padding: 45px; position: relative; }
        .modal-title { font-size: 26px; font-weight: 200; margin-bottom: 25px; color: var(--gold-light); letter-spacing: 1px; }
        .modal-description { font-size: 15px; color: #ccc; line-height: 1.9; margin-bottom: 40px; font-weight: 300; }
        
        .button-premium {
            width: 100%; padding: 24px; background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
            color: #000; border: none; border-radius: 20px; font-weight: 800; font-size: 13px;
            text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.3s;
            box-shadow: 0 15px 35px rgba(212, 175, 55, 0.2);
        }

        .reset-button {
            background: transparent; border: 1px solid rgba(255, 60, 48, 0.2);
            color: var(--accent-danger); padding: 18px 40px; border-radius: 20px;
            font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            margin: 80px auto; display: block; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="monolith-preloader">
    <div class="preloader-title">MONOLITH</div>
    <div class="preloader-subtitle">Absolute Edition V7.0</div>
    <div class="preloader-line"></div>
</div>

<header>
    <div class="header-logo">Lady Stretch</div>
    <div class="header-total-sessions">
        <span class="sessions-value" id="global-session-count">0</span>
        <span class="sessions-label">Эволюций</span>
    </div>
</header>

<div class="app-container">
    
    <span class="ui-label">Генетический профиль</span>
    <div class="glass-panel">
        <div class="tab-selector" style="margin-bottom: 25px;">
            <div class="tab-option" id="gender-male-btn" onclick="updateUserGender('m')">Мужчина</div>
            <div class="tab-option active" id="gender-female-btn" onclick="updateUserGender('f')">Женщина</div>
        </div>
        <div class="input-row">
            <div class="input-box">
                <span class="input-box-label">Вес (кг)</span>
                <input type="number" id="input-user-weight" class="input-field" placeholder="00" oninput="executeMainCalculation()">
            </div>
            <div class="input-box">
                <span class="input-box-label">Рост (см)</span>
                <input type="number" id="input-user-height" class="input-field" placeholder="000" oninput="executeMainCalculation()">
            </div>
            <div class="input-box">
                <span class="input-box-label">Возраст</span>
                <input type="number" id="input-user-age" class="input-field" placeholder="00" oninput="executeMainCalculation()">
            </div>
        </div>
    </div>

    <div class="glass-panel metric-grid">
        <div class="metric-card"><span class="metric-card-value" id="display-bmi">--</span><span class="metric-card-label">ИМТ</span></div>
        <div class="metric-card"><span class="metric-card-value" id="display-water">--</span><span class="metric-card-label">Вода (л)</span></div>
        <div class="metric-card"><span class="metric-card-value" id="display-kcal">--</span><span class="metric-card-label">Ккал</span></div>
    </div>

    <div class="glass-panel metric-grid" style="margin-top: -10px;">
        <div class="metric-card"><span class="metric-card-value" id="display-p" style="color:var(--gold-primary)">--</span><span class="metric-card-label">Белки</span></div>
        <div class="metric-card"><span class="metric-card-value" id="display-f" style="color:var(--gold-primary)">--</span><span class="metric-card-label">Жиры</span></div>
        <div class="metric-card"><span class="metric-card-value" id="display-c" style="color:var(--gold-primary)">--</span><span class="metric-card-label">Углеводы</span></div>
    </div>

    <div class="expert-advice-panel" id="bmi-expert-opinion">
        Ожидаю ввод данных для формирования персонализированного биохимического анализа вашего тела...
    </div>

    <span class="ui-label">Энергетический ресурс</span>
    <div class="glass-panel tab-selector">
        <div class="tab-option" id="energy-low" onclick="updateEnergyState('low')">Восстановление</div>
        <div class="tab-option active" id="energy-mid" onclick="updateEnergyState('mid')">Баланс</div>
        <div class="tab-option" id="energy-high" onclick="updateEnergyState('high')">Драйв</div>
    </div>

    <span class="ui-label">Протоколы (50 минут)</span>
    <div class="workout-grid" id="main-workout-container">
        </div>

    <span class="ui-label">Динамика веса</span>
    <div class="glass-panel chart-wrapper"><canvas id="weightHistoryChart"></canvas></div>

    <span class="ui-label">Активность за неделю</span>
    <div class="glass-panel chart-wrapper"><canvas id="activityPatternChart"></canvas></div>

    <button class="reset-button" onclick="performSystemReset()">Обнулить данные эволюции</button>
</div>

<div id="modal-workout-detail" class="modal-background" onclick="closeModalWindow('modal-workout-detail')">
    <div class="glass-panel modal-window" onclick="event.stopPropagation()">
        <div class="modal-title" id="target-workout-name">Название</div>
        <div class="modal-description" id="target-workout-desc">Описание</div>
        <button class="button-premium" onclick="finalizeWorkoutSession()">Интегрировать сессию</button>
    </div>
</div>

<div id="modal-achievement" class="modal-background" onclick="closeModalWindow('modal-achievement')">
    <div class="glass-panel modal-window" style="text-align: center; border: 1px solid var(--gold-primary);">
        <div style="font-size: 50px; margin-bottom: 25px;">✦</div>
        <div id="ach-rank-label" style="font-size: 10px; font-weight: 900; letter-spacing: 6px; color: var(--text-secondary); margin-bottom: 15px;">РАНГ</div>
        <div id="ach-title-label" class="modal-title" style="font-size: 34px; letter-spacing: 3px; margin-bottom: 25px;">ТИТУЛ</div>
        <div id="ach-desc-label" class="modal-description" style="text-align: left; padding: 25px; background: rgba(255,255,255,0.03); border-radius: 20px;">Описание</div>
        <button class="button-premium" onclick="closeModalWindow('modal-achievement')">Принять статус</button>
    </div>
</div>

<script>
    const telegramApp = window.Telegram.WebApp;
    telegramApp.expand();

    // ГЛОБАЛЬНОЕ ХРАНИЛИЩЕ ДАННЫХ
    let monolithDB = JSON.parse(localStorage.getItem('monolith_absolute_v7')) || {
        userGender: 'f',
        userWeight: '',
        userHeight: '',
        userAge: 35,
        activityCoefficient: 1.55,
        sessionLogs: {}, // Идентификаторы : Количеств
        registrationDates: [], 
        weightTrendValues: [],
        weightTrendLabels: [],
        completedAchievements: []
    };

    // БИБЛИОТЕКА НАПРАВЛЕНИЙ (12 ЭКСПЕРТНЫХ ПРОТОКОЛОВ)
    const workoutProtocols = [
        { id: 'pilates', name: 'Пилатес', level: 'mid', desc: 'Биомеханический протокол для укрепления глубоких стабилизаторов. Фокус на артикуляции позвоночника, контроле дыхания и создании «центра силы» через нейромышечную активацию.' },
        { id: 'mfr', name: 'МФР', level: 'low', desc: 'Миофасциальный релиз. Глубокая проработка соединительной ткани для устранения триггерных зон, детоксикации лимфатической системы и восстановления эластичности фасций.' },
        { id: 'healthy_back', name: 'Здоровая спина', level: 'low', desc: 'Терапевтическое направление. Декомпрессия межпозвоночных дисков, снятие осевой нагрузки и укрепление паравертебральных мышц для формирования статной осанки.' },
        { id: 'stretching', name: 'Стретчинг', level: 'low', desc: 'Классическая методика увеличения амплитуды движений. Удлинение мышечного волокна, улучшение кровотока в мягких тканях и профилактика суставных дисфункций.' },
        { id: 'yoga_relax', name: 'Йога релакс', level: 'low', desc: 'Антистресс-протокол. Работа с блуждающим нервом, снижение уровня кортизола и восстановление психоэмоционального баланса через глубокое погружение и статику.' },
        { id: 'sky_stretching', name: 'Sky stretching', level: 'mid', desc: 'Гравитационная разгрузка в гамаках. Использование инверсионных поз для естественного вытяжения позвоночника и развития вестибулярного аппарата.' },
        { id: 'pump_stretch', name: 'Подкачка с растяжкой', level: 'mid', desc: 'Гибридный тренинг. Чередование силовой нагрузки для гипертонуса с последующим фасциальным вытяжением для создания длинного, рельефного силуэта.' },
        { id: 'circuit', name: 'Круговая тренировка', level: 'high', desc: 'Высокоинтенсивный протокол. Работа в нескольких пульсовых зонах для ускорения метаболизма, запуска процессов липолиза и укрепления сердечно-сосудистой системы.' },
        { id: 'glute_abs', name: 'Ягодицы пресс', level: 'high', desc: 'Таргетированная скульптура. Изолированная работа над функциональностью ягодичных мышц и укреплением глубокого блока живота (Core).' },
        { id: 'body_sculpt', name: 'Body sculpt', level: 'high', desc: 'Силовой дизайн. Формирование плотной мышечной структуры через использование оборудования, работа над тонусом и качеством кожного лоскута.' },
        { id: 'tabata', name: 'Табата', level: 'high', desc: 'Протокол интервального голодания клеток (HIIT). Максимальный метаболический отклик, развитие взрывной силы и жиросжигание в течение 24 часов после сессии.' },
        { id: 'functional', name: 'Функциональный тренинг', level: 'high', desc: 'Комплексная интеграция тела. Развитие пяти физических качеств: силы, скорости, выносливости, гибкости и координации в едином 50-минутном цикле.' }
    ];

    // ИЕРАРХИЯ СТАТУСОВ
    const evolutionaryTiers = {
        8: { rank: "ИНИЦИАЦИЯ", title: "ПРОБУЖДЕНИЕ", desc: "Центральная нервная система адаптировалась к новым паттернам движения. Вы почувствовали первую свободу в суставах и улучшение лимфодренажа." },
        30: { rank: "СТАТУС", title: "ГРАЦИЯ", desc: "Фасциальная перестройка в разгаре. Ваша осанка стала естественной опорой, а метаболизм перешел в режим активного восстановления ресурсов." },
        60: { rank: "ЭЛИТА", title: "ДИВА", desc: "Биологическая трансформация. Плотность тканей и эластичность связок соответствуют эталонным показателям. Вы управляете своим телом как совершенным инструментом." },
        100: { rank: "МАСТЕР", title: "МУЗА", desc: "Вы достигли пика функциональности. Синтез коллагена и гормональный фон работают на замедление процессов старения. Вы — воплощение здоровья." },
        150: { rank: "ЛЕГЕНДА", title: "МОНОЛИТ", desc: "Абсолютная победа над гравитацией. Тело, разум и дух находятся в полном симбиозе. Ваша трансформация — пример высшей дисциплины и любви к себе." }
    };

    let globalEnergyFilter = 'mid';
    let selectedWorkoutId = null;

    // ЗАПУСК СИСТЕМЫ
    window.onload = () => {
        // Прелоадер
        setTimeout(() => { 
            document.getElementById('monolith-preloader').style.opacity = '0'; 
            setTimeout(() => document.getElementById('monolith-preloader').style.display='none', 1500); 
        }, 2000);
        
        // Заполнение данных
        document.getElementById('input-user-weight').value = monolithDB.userWeight;
        document.getElementById('input-user-height').value = monolithDB.userHeight;
        document.getElementById('input-user-age').value = monolithDB.userAge;
        
        updateUserGender(monolithDB.userGender);
        refreshWorkoutGrid();
        rebuildAnalyticalCharts();
        executeMainCalculation();
    };

    function updateUserGender(genderCode) {
        monolithDB.userGender = genderCode;
        document.getElementById('gender-male-btn').classList.toggle('active', genderCode === 'm');
        document.getElementById('gender-female-btn').classList.toggle('active', genderCode === 'f');
        executeMainCalculation();
    }

    function updateEnergyState(energyCode) {
        globalEnergyFilter = energyCode;
        document.querySelectorAll('.tab-option[id^="energy-"]').forEach(el => el.classList.remove('active'));
        document.getElementById('energy-' + energyCode).classList.add('active');
        refreshWorkoutGrid();
    }

    function executeMainCalculation() {
        const weight = parseFloat(document.getElementById('input-user-weight').value);
        const height = parseFloat(document.getElementById('input-user-height').value);
        const age = parseInt(document.getElementById('input-user-age').value);

        if (weight > 0 && height > 0 && age > 0) {
            monolithDB.userWeight = weight; monolithDB.userHeight = height; monolithDB.userAge = age;
            
            // Расчет ИМТ (Body Mass Index)
            const calculatedBMI = (weight / ((height/100) ** 2)).toFixed(1);
            document.getElementById('display-bmi').innerText = calculatedBMI;

            // Расчет Ккал (Mifflin-St Jeor Equation)
            let basalMetabolicRate = (10 * weight) + (6.25 * height) - (5 * age) + (monolithDB.userGender === 'm' ? 5 : -161);
            const totalDailyExpenditure = Math.round(basalMetabolicRate * monolithDB.activityCoefficient);
            document.getElementById('display-kcal').innerText = totalDailyExpenditure;

            // Норма воды (Hydration Level)
            document.getElementById('display-water').innerText = (weight * 0.035).toFixed(1);

            // Макронутриенты (БЖУ)
            const proteinGoal = Math.round(weight * 1.8);
            const fatGoal = Math.round(weight * 0.9);
            const carbGoal = Math.round((totalDailyExpenditure - (proteinGoal * 4 + fatGoal * 9)) / 4);
            document.getElementById('display-p').innerText = proteinGoal;
            document.getElementById('display-f').innerText = fatGoal;
            document.getElementById('display-c').innerText = carbGoal;

            // Формирование экспертного текста
            let advice = "";
            if(calculatedBMI < 18.5) advice = "Критически низкий индекс. Рекомендуем протоколы 'Body sculpt' для гипертрофии мышечной ткани и увеличение потребления белка до 2г на кг веса.";
            else if(calculatedBMI < 25) advice = "Оптимальная архитектура тела. Фокусируйтесь на 'Sky stretching' для декомпрессии и 'Функциональном тренинге' для нейромышечной координации.";
            else advice = "Превышение липидного баланса. Приоритет: 'Табата' и 'МФР'. Необходимо активировать лимфодренаж и создать метаболический дефицит через интервальные нагрузки.";
            document.getElementById('bmi-expert-opinion').innerText = advice;

            // Сохранение тренда веса
            const lastSavedWeight = monolithDB.weightTrendValues[monolithDB.weightTrendValues.length - 1];
            if (lastSavedWeight !== weight) {
                monolithDB.weightTrendValues.push(weight);
                monolithDB.weightTrendLabels.push(new Date().toLocaleDateString('ru', {day:'numeric', month:'short'}));
                rebuildAnalyticalCharts();
            }
            synchronizeStorage();
        }
    }

    function refreshWorkoutGrid() {
        const container = document.getElementById('main-workout-container');
        container.innerHTML = '';
        workoutProtocols.forEach(protocol => {
            const isFilterLocked = (globalEnergyFilter === 'low' && protocol.level === 'high') || (globalEnergyFilter === 'high' && protocol.level === 'low');
            const cardElement = document.createElement('div');
            cardElement.className = `glass-panel workout-item ${isFilterLocked ? 'disabled' : ''}`;
            cardElement.innerHTML = `
                <div class="workout-item-title">${protocol.name}</div>
                <div class="workout-item-stats">${monolithDB.sessionLogs[protocol.id] || 0} сессий</div>
            `;
            cardElement.onclick = () => { if(!isFilterLocked) openWorkoutDetail(protocol); };
            container.appendChild(cardElement);
        });
        document.getElementById('global-session-count').innerText = Object.values(monolithDB.sessionLogs).reduce((acc, val) => acc + val, 0);
    }

    function openWorkoutDetail(protocol) {
        selectedWorkoutId = protocol.id;
        document.getElementById('target-workout-name').innerText = protocol.name;
        document.getElementById('target-workout-desc').innerText = protocol.desc;
        document.getElementById('modal-workout-detail').style.display = 'flex';
    }

    function closeModalWindow(elementId) { document.getElementById(elementId).style.display = 'none'; }

    function finalizeWorkoutSession() {
        monolithDB.sessionLogs[selectedWorkoutId] = (monolithDB.sessionLogs[selectedWorkoutId] || 0) + 1;
        monolithDB.registrationDates.push(Date.now());
        
        const currentTotalSessions = Object.values(monolithDB.sessionLogs).reduce((acc, val) => acc + val, 0);
        
        synchronizeStorage();
        refreshWorkoutGrid();
        rebuildAnalyticalCharts();
        closeModalWindow('modal-workout-detail');
        telegramApp.HapticFeedback.notificationOccurred('success');

        // Проверка на достижения
        if(evolutionaryTiers[currentTotalSessions] && !monolithDB.completedAchievements.includes(currentTotalSessions)) {
            triggerAchievementSequence(currentTotalSessions);
        }
    }

    function triggerAchievementSequence(sessionCount) {
        const achievementData = evolutionaryTiers[sessionCount];
        document.getElementById('ach-rank-label').innerText = achievementData.rank;
        document.getElementById('ach-title-label').innerText = achievementData.title;
        document.getElementById('ach-desc-label').innerText = achievementData.desc;
        document.getElementById('modal-achievement').style.display = 'flex';
        monolithDB.completedAchievements.push(sessionCount);
        synchronizeStorage();
    }

    function rebuildAnalyticalCharts() {
        Chart.defaults.color = 'rgba(255,255,255,0.3)';
        Chart.defaults.font.family = 'Inter';

        // График Веса
        const weightCanvas = document.getElementById('weightHistoryChart').getContext('2d');
        if (window.weightChartInstance) window.weightChartInstance.destroy();
        window.weightChartInstance = new Chart(weightCanvas, {
            type: 'line',
            data: {
                labels: monolithDB.weightTrendLabels.slice(-7),
                datasets: [{ 
                    data: monolithDB.weightTrendValues.slice(-7), 
                    borderColor: '#D4AF37', 
                    borderWidth: 3, 
                    tension: 0.4, 
                    pointRadius: 0,
                    fill: true,
                    backgroundColor: 'rgba(212, 175, 55, 0.05)'
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });

        // График Активности
        const activityPattern = [0,0,0,0,0,0,0];
        const currentTime = Date.now();
        monolithDB.registrationDates.forEach(timestamp => { 
            if(currentTime - timestamp < 604800000) activityPattern[new Date(timestamp).getDay()]++; 
        });
        const activityCanvas = document.getElementById('activityPatternChart').getContext('2d');
        if (window.activityChartInstance) window.activityChartInstance.destroy();
        window.activityChartInstance = new Chart(activityCanvas, {
            type: 'bar',
            data: {
                labels: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
                datasets: [{ 
                    data: activityPattern, 
                    backgroundColor: 'rgba(212, 175, 55, 0.5)', 
                    borderRadius: 8,
                    barThickness: 20
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { display: false } } }
        });
    }

    function synchronizeStorage() { localStorage.setItem('monolith_absolute_v7', JSON.stringify(monolithDB)); }
    
    function performSystemReset() { 
        if(confirm("Внимание: Данное действие полностью удалит историю вашей физической эволюции. Продолжить?")) { 
            localStorage.removeItem('monolith_absolute_v7'); 
            location.reload(); 
        } 
    }
</script>
</body>
</html>
