<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monolith V8.0 | Colossus Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ============================================================ */
        /* [1] –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–ë–ê–ó–ê) */
        /* ============================================================ */
        :root {
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-bg-hover: rgba(255, 255, 255, 0.08);
            
            --accent-gold: #ffd700;
            --accent-white: #ffffff;
            --accent-error: #ff3b30;
            --accent-safe: #32d74b;
            --accent-info: #007aff;
            
            --text-p1: #ffffff;
            --text-p2: rgba(255, 255, 255, 0.5);
            --text-p3: rgba(255, 255, 255, 0.3);
            
            --font-main: 'Inter', sans-serif;
            --blur-radius: 20px;
            --anim-speed: 0.5s;
        }

        /* –û–±–Ω—É–ª–µ–Ω–∏–µ –∏ –±–∞–∑–∞ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            background-color: #000;
        }

        body {
            font-family: var(--font-main);
            color: var(--text-p1);
            /* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù –î–õ–Ø –≠–§–§–ï–ö–¢–ê –õ–ò–ù–ó–´ */
            background-image: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.8) 100%), 
                              url('https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?q=80&w=2040&auto=format&fit=crop');
            background-attachment: fixed;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            line-height: 1.6;
            zoom: 0.85; /* –≠–ª–∏—Ç–Ω—ã–π –º–∞—Å—à—Ç–∞–± */
        }

        /* ============================================================ */
        /* [2] –ê–ù–ò–ú–ê–¶–ò–ò –ò –≠–§–§–ï–ö–¢–´ (–ü–ï–†–ï–•–û–î–´) */
        /* ============================================================ */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(1000%); }
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 10px rgba(255,255,255,0.05); }
            50% { box-shadow: 0 0 30px rgba(255,255,255,0.15); }
            100% { box-shadow: 0 0 10px rgba(255,255,255,0.05); }
        }

        @keyframes lineAppear {
            0% { height: 0; opacity: 0; }
            100% { height: 100px; opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================================ */
        /* [3] –ü–†–ï–õ–û–ê–î–ï–† (–¢–ï–•–ù–û–õ–û–ì–ò–ß–ù–´–ô –í–•–û–î) */
        /* ============================================================ */
        #loading-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 100000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 1.2s cubic-bezier(0.9, 0, 0.1, 1);
        }

        .loader-thread {
            width: 1px;
            height: 100px;
            background: linear-gradient(to bottom, transparent, #fff, transparent);
            animation: lineAppear 2s forwards ease-in-out;
        }

        .loader-logo {
            font-size: 30px;
            font-weight: 100;
            letter-spacing: 25px;
            text-transform: uppercase;
            margin: 40px 0;
            color: #fff;
            text-indent: 25px;
        }

        .loader-status {
            font-size: 9px;
            letter-spacing: 5px;
            color: var(--text-p3);
            text-transform: uppercase;
        }

        /* ============================================================ */
        /* [4] –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (HEADER) */
        /* ============================================================ */
        .system-header {
            position: sticky;
            top: 0;
            width: 100%;
            height: 100px;
            z-index: 5000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-bottom: 1px solid var(--glass-border);
        }

        .system-logo {
            font-size: 24px;
            font-weight: 200;
            letter-spacing: 6px;
            color: var(--accent-white);
        }

        .system-counter {
            text-align: right;
        }

        .counter-big {
            font-size: 48px;
            font-weight: 100;
            color: var(--accent-gold);
            line-height: 0.9;
        }

        .counter-label {
            font-size: 9px;
            color: var(--text-p2);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* ============================================================ */
        /* [5] –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† (LAYOUT) */
        /* ============================================================ */
        .main-wrapper {
            max-width: 540px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section-headline {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: var(--text-p3);
            margin: 60px 0 25px 10px;
        }

        /* –°–¢–ï–ö–õ–Ø–ù–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê - –õ–ò–ù–ó–ê */
        .monolith-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 35px;
            padding: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(var(--blur-radius));
            -webkit-backdrop-filter: blur(var(--blur-radius));
            position: relative;
            overflow: hidden;
            transition: var(--anim-speed);
        }

        .monolith-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, transparent 100%);
            pointer-events: none;
        }

        .monolith-card:hover {
            background: var(--glass-bg-hover);
            border-color: rgba(255,255,255,0.3);
        }

        /* –ì—Ä—É–ø–ø—ã –∫–Ω–æ–ø–æ–∫ */
        .action-row {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .toggle-btn {
            flex: 1;
            padding: 22px;
            text-align: center;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            color: var(--text-p2);
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-btn.active {
            background: #fff;
            color: #000;
            border-color: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö */
        .data-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .input-container {
            position: relative;
        }

        .monolith-input {
            width: 100%;
            background: transparent;
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px 5px;
            color: #fff;
            text-align: center;
            font-size: 26px;
            font-weight: 200;
            transition: 0.3s;
        }

        .monolith-input:focus {
            border-color: #fff;
            background: rgba(255,255,255,0.05);
        }

        .input-sub {
            position: absolute;
            bottom: 8px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 8px;
            color: var(--text-p3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –°–µ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .res-box {
            text-align: center;
            padding: 25px 5px;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.2);
        }

        .res-val {
            display: block;
            font-size: 28px;
            font-weight: 100;
            margin-bottom: 5px;
        }

        .res-unit {
            font-size: 9px;
            color: var(--text-p2);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* –ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –ò–ò */
        .ai-status-panel {
            padding: 30px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 300;
            line-height: 1.8;
            color: #ccc;
            background: rgba(255,255,255,0.02);
            border-left: 4px solid var(--accent-safe);
            margin-bottom: 40px;
        }

        /* –ë–ñ–£ –°–µ–∫—Ü–∏—è */
        .pfc-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 50px;
        }

        .pfc-item {
            padding: 22px 5px;
            text-align: center;
            border-radius: 22px;
            border: 1px solid var(--glass-border);
        }

        .pfc-number {
            font-size: 20px;
            font-weight: 800;
            color: var(--accent-gold);
            display: block;
        }

        .pfc-label {
            font-size: 9px;
            color: var(--text-p3);
            text-transform: uppercase;
            margin-top: 5px;
        }

        /* –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ */
        .workout-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
        }

        .workout-item {
            padding: 30px 22px;
            min-height: 165px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 28px;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .workout-item:active {
            transform: scale(0.95);
        }

        .workout-item.locked {
            opacity: 0.15;
            filter: grayscale(1);
            pointer-events: none;
        }

        .workout-name {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            line-height: 1.3;
        }

        .workout-meta {
            font-size: 10px;
            font-weight: 800;
            color: var(--accent-gold);
            text-transform: uppercase;
        }

        /* ============================================================ */
        /* [6] –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (OVERLAYS) */
        /* ============================================================ */
        .system-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            backdrop-filter: blur(50px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 25px;
        }

        .modal-inner {
            width: 100%;
            max-width: 440px;
            background: #0a0a0a;
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 45px;
            position: relative;
            animation: fadeIn 0.5s ease-out;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 100;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 25px;
            text-align: center;
        }

        .modal-body {
            font-size: 15px;
            color: #888;
            line-height: 1.9;
            margin-bottom: 35px;
            font-weight: 300;
        }

        .system-btn {
            width: 100%;
            padding: 24px;
            background: #fff;
            color: #000;
            border: none;
            border-radius: 22px;
            font-weight: 900;
            font-size: 14px;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
        }

        .system-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255,255,255,0.2);
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ */
        .award-card {
            border: 1px solid var(--accent-gold);
            text-align: center;
        }

        .award-icon {
            font-size: 50px;
            margin-bottom: 20px;
            display: block;
        }

        /* –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö */
        .danger-reset {
            display: block;
            margin: 100px auto;
            color: var(--accent-error);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.3;
            cursor: pointer;
            transition: 0.3s;
        }

        .danger-reset:hover { opacity: 1; }
    </style>
</head>
<body>

<div id="loading-screen">
    <div class="loader-thread"></div>
    <div class="loader-logo">MONOLITH</div>
    <div class="loader-status">Initializing Neural Interface...</div>
</div>

<header class="system-header">
    <div class="system-logo">LADY STRETCH</div>
    <div class="system-counter">
        <div class="counter-big" id="global-counter">0</div>
        <div class="counter-label">Sessions Mastery</div>
    </div>
</header>

<div class="main-wrapper">
    
    <div class="section-headline">Personal Biometrics</div>
    
    <div class="action-row">
        <div class="toggle-btn active" id="sex-m" onclick="updateGender('m')">Male</div>
        <div class="toggle-btn" id="sex-f" onclick="updateGender('f')">Female</div>
    </div>
    
    <div class="monolith-card" style="padding: 20px; text-align: center; cursor: pointer;" onclick="togglePALModal()">
        Lifestyle Activity: <span id="pal-display" style="color:var(--accent-gold); font-weight: 800;">Optimal</span>
    </div>

    <div class="data-input-group">
        <div class="input-container">
            <input type="number" id="v-weight" class="monolith-input" placeholder="0" oninput="runEngine()">
            <div class="input-sub">Weight (kg)</div>
        </div>
        <div class="input-container">
            <input type="number" id="v-height" class="monolith-input" placeholder="0" oninput="runEngine()">
            <div class="input-sub">Height (cm)</div>
        </div>
        <div class="input-container">
            <input type="number" id="v-age" class="monolith-input" placeholder="0" oninput="runEngine()">
            <div class="input-sub">Age (years)</div>
        </div>
    </div>
    
    <div class="results-grid">
        <div class="res-box"><span class="res-val" id="out-bmi">--</span><span class="res-unit">BMI Index</span></div>
        <div class="res-box"><span class="res-val" id="out-water">--</span><span class="res-unit">H2O (Liters)</span></div>
        <div class="res-box"><span class="res-val" id="out-bmr">--</span><span class="res-unit">Total Kcal</span></div>
    </div>
    
    <div id="ai-verdict" class="ai-status-panel">
        –°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –∞–Ω—Ç—Ä–æ–ø–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –ú–∏—Ñ—Ñ–ª–∏–Ω–∞-–°–∞–Ω –ñ–µ–æ—Ä–∞.
    </div>

    <div class="section-headline">Nutrition 24h Protocol</div>
    <div class="pfc-container">
        <div class="pfc-item"><span class="pfc-number" id="p-val">--</span><span class="pfc-label">Proteins</span></div>
        <div class="pfc-item"><span class="pfc-number" id="f-val">--</span><span class="pfc-label">Fats</span></div>
        <div class="pfc-item"><span class="pfc-number" id="c-val">--</span><span class="pfc-label">Carbs</span></div>
    </div>

    <div class="section-headline">Current Resource State</div>
    <div class="action-row">
        <div class="toggle-btn" id="e-low" onclick="setEnergy('low')">Low</div>
        <div class="toggle-btn active" id="e-mid" onclick="setEnergy('mid')">Balance</div>
        <div class="toggle-btn" id="e-high" onclick="setEnergy('high')">Peak</div>
    </div>

    <div class="section-headline">Available Training Modes</div>
    <div class="workout-grid" id="training-engine">
        </div>

    <div class="section-headline">Evolution Analytics</div>
    <div class="monolith-card" style="padding: 25px;">
        <canvas id="mainChart" height="230"></canvas>
    </div>

    <div class="danger-reset" onclick="hardReset()">Factory Reset All Evolution Data</div>
</div>

<div id="modal-pal" class="system-modal" onclick="togglePALModal()">
    <div class="modal-inner" onclick="event.stopPropagation()">
        <div class="modal-title">Activity Level</div>
        <div class="monolith-card" style="margin-bottom:15px; cursor:pointer;" onclick="applyPAL(1.2, 'Sedentary')">
            <b>SEDENTARY</b><br><small>Minimal movement, desk work, no sports.</small>
        </div>
        <div class="monolith-card" style="margin-bottom:15px; cursor:pointer;" onclick="applyPAL(1.55, 'Optimal')">
            <b>OPTIMAL</b><br><small>3-4 Lady Stretch sessions per week.</small>
        </div>
        <div class="monolith-card" style="cursor:pointer;" onclick="applyPAL(1.9, 'Professional')">
            <b>PROFESSIONAL</b><br><small>High intensity daily physical activity.</small>
        </div>
    </div>
</div>

<div id="modal-workout" class="system-modal" onclick="closeWorkoutModal()">
    <div class="modal-inner" onclick="event.stopPropagation()">
        <div id="mw-title" class="modal-title" style="color:var(--accent-gold);"></div>
        <div id="mw-desc" class="modal-body"></div>
        <div class="ai-status-panel" style="margin-bottom:30px; border-left-color:var(--accent-gold);">
            <b>PRO TIP:</b> –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏. –î–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≥–ª—É–±–æ–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.
        </div>
        <button class="system-btn" onclick="confirmWorkout()">Log Session Complete</button>
    </div>
</div>

<div id="modal-award" class="system-modal" onclick="this.style.display='none'">
    <div class="modal-inner award-card" onclick="event.stopPropagation()">
        <span class="award-icon">üíé</span>
        <div id="award-title" class="modal-title" style="color:var(--accent-gold); margin-bottom:10px;"></div>
        <div id="award-text" class="modal-body"></div>
        <button class="system-btn" style="background:var(--accent-gold);" onclick="document.getElementById('modal-award').style.display='none'">Continue Journey</button>
    </div>
</div>

<script>
    /* ============================================================ */
    /* [8] –°–ö–†–ò–ü–¢–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (LOGIC CORE) */
    /* ============================================================ */
    
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (LocalStorage)
    let db = JSON.parse(localStorage.getItem('monolith_v8_db')) || {
        sex: 'm', weight: '', height: '', age: 44, pal: 1.55, palName: 'Optimal',
        logs: {}, history: { val: [], date: [] }
    };

    // –ë–∞–∑–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è)
    const library = [
        { 
            id: 'mfr', 
            name: '–ú–§–† –¢–µ—Ä–∞–ø–∏—è', 
            energy: 'low', 
            desc: '–ú–∏–æ—Ñ–∞—Å—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑ ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥–∏–∫–∞ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ç–∫–∞–Ω—å. –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –∑–∞–∂–∏–º—ã, —É–ª—É—á—à–∞–µ—Ç –ª–∏–º—Ñ–æ—Ç–æ–∫ –∏ –≥–æ—Ç–æ–≤–∏—Ç –º—ã—à—Ü—ã –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º.' 
        },
        { 
            id: 'back', 
            name: '–ó–¥–æ—Ä–æ–≤–∞—è –°–ø–∏–Ω–∞', 
            energy: 'low', 
            desc: '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –æ—Å–∞–Ω–∫–∏ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–æ–≤. –ü—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–Ω—è—Ç–∏–µ –æ—Å–µ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Å –ø–æ–∑–≤–æ–Ω–æ—á–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤.' 
        },
        { 
            id: 'yoga', 
            name: '–ô–æ–≥–∞ –†–µ–ª–∞–∫—Å', 
            energy: 'low', 
            desc: '–ú—è–≥–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –¶–ù–°. –§–æ–∫—É—Å –Ω–∞ –¥—ã—Ö–∞–Ω–∏–∏ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º –Ω–∞—Ç—è–∂–µ–Ω–∏–∏ –≥–ª—É–±–æ–∫–∏—Ö —Ñ–∞—Å—Ü–∏–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π.' 
        },
        { 
            id: 'stretch', 
            name: '–°—Ç—Ä–µ—Ç—á–∏–Ω–≥', 
            energy: 'low', 
            desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –≤—Å–µ—Ö –≥—Ä—É–ø–ø –º—ã—à—Ü. –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∞–º–ø–ª–∏—Ç—É–¥—É –¥–≤–∏–∂–µ–Ω–∏–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–ª—É –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—É—é –ª–µ–≥–∫–æ—Å—Ç—å.' 
        },
        { 
            id: 'sky', 
            name: 'Sky Stretch', 
            energy: 'mid', 
            desc: '–†–∞—Å—Ç—è–∂–∫–∞ –≤ –≥–∞–º–∞–∫–∞—Ö. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–ª—ã –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –¥–ª—è –º—è–≥–∫–æ–≥–æ –≤—ã—Ç—è–∂–µ–Ω–∏—è –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –∏ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ —Å—É—Å—Ç–∞–≤–æ–≤.' 
        },
        { 
            id: 'split', 
            name: '–®–ø–∞–≥–∞—Ç', 
            energy: 'mid', 
            desc: '–¶–µ–ª–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –≥–∏–±–∫–æ—Å—Ç–∏ —Ç–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞. –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–æ–∫.' 
        },
        { 
            id: 'pilates', 
            name: '–ü–∏–ª–∞—Ç–µ—Å', 
            energy: 'mid', 
            desc: '–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–µ–ª–∞. –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à–µ—á–Ω–æ–≥–æ –∫–æ—Ä—Å–µ—Ç–∞ –∏ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –≥–ª—É–±–æ–∫–∏—Ö –º—ã—à—Ü –∂–∏–≤–æ—Ç–∞ –∏ —Å–ø–∏–Ω—ã –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ –æ–±—ä–µ–º–∞.' 
        },
        { 
            id: 'circ', 
            name: '–ö—Ä—É–≥–æ–≤–∞—è', 
            energy: 'mid', 
            desc: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç—Ä–µ–Ω–∏–Ω–≥ –Ω–∞ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –∏ —Ç–æ–Ω—É—Å. –°–æ—á–µ—Ç–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞.' 
        },
        { 
            id: 'tabata', 
            name: '–¢–∞–±–∞—Ç–∞ HIIT', 
            energy: 'high', 
            desc: '–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª 20/10. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∏–≥–∞–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–π –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã.' 
        },
        { 
            id: 'sculpt', 
            name: 'Body Sculpt', 
            energy: 'high', 
            desc: '–°–∏–ª–æ–≤–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–ø. –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–æ—Ç–Ω–æ–≥–æ –º—ã—à–µ—á–Ω–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞.' 
        },
        { 
            id: 'trx', 
            name: 'TRX –ü–µ—Ç–ª–∏', 
            energy: 'high', 
            desc: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–∏–Ω–≥ –≤ –ø–æ–¥–≤–µ—Å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –†–∞–∑–≤–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å, —Å–∏–ª—É –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.' 
        },
        { 
            id: 'butt', 
            name: '–Ø–≥–æ–¥–∏—Ü—ã + –ü—Ä–µ—Å—Å', 
            energy: 'high', 
            desc: '–ê–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ —ç—Å—Ç–µ—Ç–∏–∫–æ–π –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ —Ç–µ–ª–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é –ø—Ä–µ—Å—Å–∞. –í—ã—Å–æ–∫–∞—è –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞.' 
        }
    ];

    let currentE = 'mid';
    let activePID = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
    window.addEventListener('DOMContentLoaded', () => {
        // –¢–∞–π–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
            document.getElementById('loading-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('loading-screen').style.display='none', 1200);
        }, 2500);

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('v-weight').value = db.weight;
        document.getElementById('v-height').value = db.height;
        document.getElementById('v-age').value = db.age;
        document.getElementById('pal-display').innerText = db.palName;
        
        updateGender(db.sex);
        drawChart();
        renderWorkouts();
        runEngine();
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ–º
    function updateGender(s) {
        db.sex = s;
        document.getElementById('sex-m').classList.toggle('active', s === 'm');
        document.getElementById('sex-f').classList.toggle('active', s === 'f');
        runEngine();
        save();
    }

    // –ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤
    function runEngine() {
        const w = parseFloat(document.getElementById('v-weight').value);
        const h = parseFloat(document.getElementById('v-height').value);
        const a = parseInt(document.getElementById('v-age').value);

        if (w > 0 && h > 0 && a > 0) {
            db.weight = w; db.height = h; db.age = a;
            
            // –†–∞—Å—á–µ—Ç –ò–ú–¢
            const bmi = (w / ((h/100)**2)).toFixed(1);
            document.getElementById('out-bmi').innerText = bmi;

            // –í–µ—Ä–¥–∏–∫—Ç –ò–ò
            const ai = document.getElementById('ai-verdict');
            if (bmi > 25) {
                ai.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 70% —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ —Ä–µ–∂–∏–º–µ HIGH (–¢–∞–±–∞—Ç–∞/Sculpt) –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ª–∏–ø–æ–ª–∏–∑–∞.`;
                ai.style.borderLeftColor = 'var(--accent-error)';
            } else if (bmi < 18.5) {
                ai.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} –Ω–∏–∂–µ –Ω–æ—Ä–º—ã. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–∏–ª–æ–≤–æ–π –ü–∏–ª–∞—Ç–µ—Å –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –±–µ–ª–∫–æ–≤–æ–π —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π —Ä–∞—Ü–∏–æ–Ω–∞ –Ω–∞ 25%.`;
                ai.style.borderLeftColor = 'var(--accent-info)';
            } else {
                ai.innerText = `–ê–Ω–∞–ª–∏–∑: –ò–ú–¢ ${bmi} –∏–¥–µ–∞–ª–µ–Ω. –¢–µ–ª–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≥–æ–º–µ–æ—Å—Ç–∞–∑–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ Balance –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ç–æ–Ω—É—Å–∞.`;
                ai.style.borderLeftColor = 'var(--accent-safe)';
            }

            // –ö–∞–ª–æ—Ä–∏–∏ –∏ –í–æ–¥–∞
            let base = (10 * w) + (6.25 * h) - (5 * a) + (db.sex === 'm' ? 5 : -161);
            const totalKcal = Math.round(base * db.pal);
            document.getElementById('out-bmr').innerText = totalKcal;
            document.getElementById('out-water').innerText = (w * (db.pal > 1.4 ? 0.04 : 0.033)).toFixed(1);

            // –ë–ñ–£ (–§–æ—Ä–º—É–ª–∞ 30/30/40)
            const p = Math.round(w * 1.8);
            const f = Math.round(w * 0.9);
            const c = Math.round((totalKcal - (p*4 + f*9))/4);
            document.getElementById('p-val').innerText = p;
            document.getElementById('f-val').innerText = f;
            document.getElementById('c-val').innerText = c;

            // –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
            if (db.history.val[db.history.val.length - 1] !== w) {
                db.history.val.push(w);
                db.history.date.push(new Date().toLocaleDateString('ru', {day:'numeric', month:'short'}));
                drawChart();
            }
            save();
        }
    }

    // –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏
    function setEnergy(e) {
        currentE = e;
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            if (['e-low','e-mid','e-high'].includes(btn.id)) btn.classList.remove('active');
        });
        document.getElementById('e-' + e).classList.add('active');
        renderWorkouts();
    }

    function renderWorkouts() {
        const grid = document.getElementById('training-engine');
        grid.innerHTML = '';
        library.forEach(item => {
            const isDim = (currentE === 'low' && item.energy === 'high') || (currentE === 'high' && item.energy === 'low');
            const card = document.createElement('div');
            card.className = `workout-item ${isDim ? 'locked' : ''}`;
            card.innerHTML = `
                <div class="workout-name">${item.name}</div>
                <div class="workout-meta">${db.logs[item.id] || 0} SECTIONS</div>
            `;
            card.onclick = () => { if(!isDim) openWorkout(item); };
            grid.appendChild(card);
        });
        document.getElementById('global-counter').innerText = Object.values(db.logs).reduce((a,b)=>a+b,0);
    }

    function openWorkout(item) {
        activePID = item.id;
        document.getElementById('mw-title').innerText = item.name;
        document.getElementById('mw-desc').innerText = item.desc;
        document.getElementById('modal-workout').style.display = 'flex';
    }

    function confirmWorkout() {
        db.logs[activePID] = (db.logs[activePID] || 0) + 1;
        const total = Object.values(db.logs).reduce((a,b)=>a+b,0);
        save(); renderWorkouts(); closeWorkoutModal();
        tg.HapticFeedback.notificationOccurred('success');
        checkMilestones(total);
    }

    // –°–∏—Å—Ç–µ–º–∞ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è)
    function checkMilestones(count) {
        let t = "", b = "";
        if (count === 8) {
            t = "–°–¢–ê–î–ò–Ø: –ê–î–ê–ü–¢–ê–¶–ò–Ø";
            b = "8 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –í–∞—à–∞ –Ω–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫ –Ω–æ–≤—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –¥–≤–∏–∂–µ–Ω–∏—è. –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ—Å—É–¥–æ–≤ —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å –Ω–∞ 12%.";
        } else if (count === 24) {
            t = "–°–¢–ê–î–ò–Ø: –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–Ø";
            b = "24 –∑–∞–Ω—è—Ç–∏—è. –ì–ª—É–±–æ–∫–∏–µ —Å–ª–æ–∏ —Ñ–∞—Å—Ü–∏–π —Å—Ç–∞–ª–∏ —ç–ª–∞—Å—Ç–∏—á–Ω—ã–º–∏. –ú–µ—Ç–∞–±–æ–ª–∏–∑–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è –≤—ã—Ä–æ—Å –Ω–∞ 7%. –í—ã –Ω–∞—á–∞–ª–∏ –º–µ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ç–µ–ª–∞.";
        } else if (count === 50) {
            t = "–°–¢–ê–î–ò–Ø: –ê–¢–õ–ï–¢–ò–ó–ú";
            b = "50 –∑–∞–Ω—è—Ç–∏–π. –ú—ã—à–µ—á–Ω—ã–π –∫–æ—Ä—Å–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω. –£—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ —Å–Ω–∏–∂–µ–Ω –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Å–Ω–æ–≤–µ. –¢–µ–ª–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º.";
        } else if (count === 100) {
            t = "–°–¢–ê–¢–£–°: –ú–û–ù–û–õ–ò–¢";
            b = "100 –¢–†–ï–ù–ò–†–û–í–û–ö! –í—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ —ç–ª–∏—Ç—É Lady Stretch. –í–∞—à–∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞—Ç–ª–µ—Ç—É. –í—ã —Å–æ–∑–¥–∞–ª–∏ —Å–µ–±—è –∑–∞–Ω–æ–≤–æ.";
        } else if (count === 200) {
            t = "–°–¢–ê–¢–£–°: –õ–ï–ì–ï–ù–î–ê";
            b = "200 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. –ü—Ä–µ–¥–µ–ª –≥–∏–±–∫–æ—Å—Ç–∏ –∏ —Å–∏–ª—ã –¥–æ—Å—Ç–∏–≥–Ω—É—Ç. –í–∞—à –æ–ø—ã—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞ –Ω–µ–π—Ä–æ–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.";
        }

        if (t) {
            document.getElementById('award-title').innerText = t;
            document.getElementById('award-text').innerText = b;
            document.getElementById('modal-award').style.display = 'flex';
        }
    }

    // –•–µ–ª–ø–µ—Ä—ã –∏ –ú–æ–¥–∞–ª–∫–∏
    function togglePALModal() {
        const m = document.getElementById('modal-pal');
        m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
    }

    function applyPAL(v, n) {
        db.pal = v; db.palName = n;
        document.getElementById('pal-display').innerText = n;
        togglePALModal(); runEngine();
    }

    function closeWorkoutModal() { document.getElementById('modal-workout').style.display = 'none'; }
    function save() { localStorage.setItem('monolith_v8_db', JSON.stringify(db)); }
    function hardReset() { if(confirm("–í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")) { localStorage.clear(); location.reload(); } }

    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (Chart.js)
    function drawChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: db.history.date.slice(-7),
                datasets: [{
                    data: db.history.val.slice(-7),
                    borderColor: '#fff',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: { target: 'origin', above: 'rgba(255,255,255,0.03)' },
                    pointRadius: 5,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { 
                        grid: { color: 'rgba(255,255,255,0.05)' }, 
                        ticks: { color: 'rgba(255,255,255,0.3)', font: { size: 10 } } 
                    }
                }
            }
        });
    }
</script>

</body>
</html>
