<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lady Stretch | Analytical Portal</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #b085ff;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.12);
        }

        body, html {
            margin: 0; padding: 0; min-height: 100vh;
            background: #050508; font-family: 'Montserrat', sans-serif;
            color: #fff; overflow-x: hidden;
        }

        .bg-space {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 0%, #1a1233 0%, #050508 100%);
            z-index: -2;
        }

        /* HEADER */
        header {
            position: fixed; top: 0; width: 100%; height: 75px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box; z-index: 1000;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(20px);
            border-bottom: 0.5px solid var(--border);
        }
        .logo-c { width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--accent); overflow: hidden; }
        .logo-c img { width: 100%; height: 100%; object-fit: cover; }

        /* LAYOUT */
        .container {
            max-width: 1000px; margin: 0 auto; padding: 95px 15px 40px;
            display: grid; grid-template-columns: 1fr 340px; gap: 20px;
        }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }

        .glass {
            background: var(--glass); backdrop-filter: blur(30px);
            border: 1px solid var(--border); border-radius: 30px;
            padding: 25px; position: relative;
        }

        /* КНОПКИ НАПРАВЛЕНИЙ */
        .dir-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .dir-btn {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 20px; padding: 18px 10px; text-align: center;
            font-size: 11px; cursor: pointer; transition: 0.3s;
        }
        .dir-btn.active { background: #fff; color: #000; font-weight: 600; box-shadow: 0 0 15px #fff; }

        /* INPUT BLOCK */
        .input-panel { margin-top: 20px; display: none; }
        .input-panel.show { display: block; animation: fadeInUp 0.4s; }
        .f-input {
            width: 100%; background: transparent; border: none; border-bottom: 1.5px solid var(--accent);
            color: #fff; font-size: 32px; padding: 10px 0; outline: none; margin: 15px 0;
        }
        .f-btn {
            width: 100%; background: #fff; color: #000; border: none; padding: 18px;
            border-radius: 20px; font-weight: 600; text-transform: uppercase; cursor: pointer;
        }

        /* MILESTONE MODAL */
        #milestone {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(15px);
            z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .milestone-card {
            background: linear-gradient(135deg, rgba(176,133,255,0.2), rgba(255,255,255,0.05));
            border: 1px solid #fff; border-radius: 40px; padding: 40px; text-align: center;
            max-width: 400px; box-shadow: 0 0 50px var(--accent);
        }

        .label { font-size: 9px; letter-spacing: 2px; color: var(--accent); text-transform: uppercase; display: block; margin-bottom: 10px; }
        .report-item { font-size: 12px; margin: 5px 0; color: #ccc; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="bg-space"></div>

<header>
    <div class="logo-c"><img src="lady_logo.png" alt="LS"></div>
    <div style="font-weight: 100; letter-spacing: 2px; font-size: 10px; text-align: center; flex: 1;">АНАЛИТИКА ТВОЕЙ ТРАНСФОРМАЦИИ</div>
    <div style="font-size: 10px; color: var(--accent);">MENU</div>
</header>

<div class="container">
    <div class="main-col">
        <div class="glass" style="margin-bottom: 20px;">
            <span class="label">Динамика посещений по месяцам</span>
            <canvas id="evolutionChart" style="height: 220px;"></canvas>
        </div>

        <div class="dir-grid">
            <div class="dir-btn" onclick="openDir(this, 'abs')">Ягодицы + Пресс</div>
            <div class="dir-btn" onclick="openDir(this, 'spine')">Здоровая спина</div>
            <div class="dir-btn" onclick="openDir(this, 'stretch')">Шпагат</div>
            <div class="dir-btn" onclick="openDir(this, 'sky')">Sky Stretching</div>
            <div class="dir-btn" onclick="openDir(this, 'tabata')">Табата</div>
            <div class="dir-btn" onclick="openDir(this, 'sculpt')">Body Sculpt</div>
        </div>
    </div>

    <div class="side-col">
        <div class="glass" style="margin-bottom: 20px;">
            <span class="label">Месячный отчет: Январь</span>
            <div id="month-report">
                <p class="report-item">Занятий в этом месяце: <b id="m-total">0</b></p>
                <div id="m-details" style="border-top: 1px solid var(--border); margin-top: 10px; padding-top: 10px;"></div>
            </div>
            <div id="bio-insight" style="font-size: 11px; margin-top: 15px; line-height: 1.5; color: var(--accent);">
                Выберите направление, чтобы увидеть прогресс.
            </div>
        </div>

        <div class="glass" id="input-area" style="display: none;">
            <span class="label" id="dir-name">Направление</span>
            <p id="dir-hint" style="font-size: 10px; color: #666;"></p>
            <input type="number" class="f-input" id="num-val" placeholder="0">
            <button class="f-btn" onclick="saveData()">Добавить занятие</button>
        </div>
    </div>
</div>

<div id="milestone" onclick="this.style.display='none'">
    <div class="milestone-card">
        <div class="label" style="color:#fff">ПОЗДРАВЛЯЕМ!</div>
        <h2 style="font-weight: 100; margin: 10px 0;">8 ЗАНЯТИЙ</h2>
        <p id="ms-text" style="font-size: 13px; line-height: 1.6; font-weight: 300;"></p>
        <div style="margin-top: 20px; font-size: 10px; letter-spacing: 2px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
            ХОТИТЕ УЗНАТЬ, ЧТО БУДЕТ НА 16-Й ТРЕНИРОВКЕ?
        </div>
    </div>
</div>

<script>
    // 1. DATA ENGINE
    let store = JSON.parse(localStorage.getItem('ls_v3')) || {
        firstEntry: true,
        monthData: Array(12).fill(0), // Янв-Дек
        details: { abs: 0, spine: 0, stretch: 0, sky: 0, tabata: 0, sculpt: 0 }
    };

    let activeType = '';
    const currentMonth = new Date().getMonth(); // 0 = Январь

    // 2. CHART ENGINE
    const ctx = document.getElementById('evolutionChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Янв','Фев','Мар','Апр','Май','Июн','Июл','Авг','Сен','Окт','Ноя','Дек'],
            datasets: [{
                label: 'Посещения',
                data: store.monthData,
                backgroundColor: 'rgba(176, 133, 255, 0.5)',
                borderColor: '#b085ff',
                borderWidth: 1,
                borderRadius: 10
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: { y: { display: false }, x: { grid: {display: false}, ticks: {color: '#555'} } },
            plugins: { legend: { display: false } }
        }
    });

    // 3. LOGIC
    const science = {
        abs: "<b>Ягодицы+Пресс:</b> 8 занятий запустили процесс 'капиллярного прорастания'. Ткани стали получать на 40% больше питания. На 16-й отметке мышечный корсет станет твоей естественной поддержкой осанки.",
        spine: "<b>Здоровая спина:</b> 8 часов работы восстановили гидратацию межпозвоночных хрящей. Прошли застойные явления. На 16-й отметке уйдут мышечные зажимы, влияющие на головные боли.",
        stretch: "<b>Шпагат:</b> Фасции стали эластичными. Кровь в области малого таза циркулирует свободно. На 16-й отметке амплитуда движений увеличит твой гормональный фон."
    };

    function openDir(btn, type) {
        document.querySelectorAll('.dir-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeType = type;
        
        document.getElementById('input-area').style.display = 'block';
        document.getElementById('dir-name').innerText = btn.innerText;
        document.getElementById('dir-hint').innerText = store.firstEntry ? "Ввод данных с 1.01.26" : `Уже пройдено: ${store.details[type]}`;
        document.getElementById('num-val').focus();
    }

    function saveData() {
        const val = parseInt(document.getElementById('num-val').value) || 0;
        
        if(store.firstEntry) {
            store.details[activeType] = val;
            store.monthData[currentMonth] += val;
        } else {
            store.details[activeType] += val;
            store.monthData[currentMonth] += val;
        }

        // Check Milestone
        if(store.details[activeType] >= 8 && store.details[activeType] < 10) {
            showMilestone(activeType);
        }

        store.firstEntry = false;
        updateUI();
        document.getElementById('num-val').value = '';
        window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
    }

    function showMilestone(type) {
        document.getElementById('ms-text').innerHTML = science[type] || science.abs;
        document.getElementById('milestone').style.display = 'flex';
    }

    function updateUI() {
        // Update Chart
        chart.data.datasets[0].data = store.monthData;
        chart.update();

        // Update Report
        document.getElementById('m-total').innerText = store.monthData[currentMonth];
        let html = '';
        const names = {abs:'Ягодицы', spine:'Спина', stretch:'Шпагат', sky:'Sky', tabata:'Табата', sculpt:'Sculpt'};
        for(let key in store.details) {
            if(store.details[key] > 0) {
                html += `<p class="report-item">${names[key]}: <b>${store.details[key]}</b></p>`;
            }
        }
        document.getElementById('m-details').innerHTML = html;
        
        localStorage.setItem('ls_v3', JSON.stringify(store));
    }

    updateUI();
</script>
</body>
</html>
