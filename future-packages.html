<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lady Stretch | Absolute Monolith 11.2</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #CD7F32; /* –ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –±—Ä–æ–Ω–∑–∞ */
            --accent-glow: rgba(205, 127, 50, 0.4);
            --bg-deep: #050505;
            --panel-bg: rgba(15, 15, 15, 0.95);
            --border: rgba(205, 127, 50, 0.2);
            --text: #ffffff;
            --text-dim: #888;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-deep); color: var(--text); font-family: 'Inter', sans-serif; min-height: 100vh; overflow-x: hidden; }

        /* –§–û–ù –ö–û–¢–û–†–´–ô –ù–ï –ì–£–õ–Ø–ï–¢ */
        .bg-fixed {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
            z-index: -1; transform: translateZ(0);
        }

        /* –õ–ê–ó–ï–†–ù–´–ô –°–ö–ê–ù–ï–† */
        #scanner {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: 1.5s ease-in-out;
        }
        .laser {
            position: absolute; width: 100%; height: 2px; background: var(--accent);
            box-shadow: 0 0 25px var(--accent); animation: scan 2.5s infinite ease-in-out;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        /* –®–ê–ü–ö–ê */
        header {
            position: sticky; top: 0; width: 100%; height: 90px;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border); z-index: 1000;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }
        .logo { font-size: 18px; font-weight: 200; letter-spacing: 6px; }
        .logo b { color: var(--accent); font-weight: 900; }
        .counter { text-align: right; }
        .counter-num { font-size: 34px; font-weight: 900; color: var(--accent); line-height: 0.8; }
        .counter-label { font-size: 8px; font-weight: 900; color: var(--text-dim); letter-spacing: 2px; margin-top: 5px; }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† */
        .container { padding: 25px; max-width: 500px; margin: 0 auto; }

        .label {
            font-size: 11px; font-weight: 900; color: var(--accent);
            text-transform: uppercase; letter-spacing: 3px;
            margin: 35px 0 15px 5px; display: block;
        }

        .panel {
            background: var(--panel-bg); border: 1px solid var(--border);
            border-radius: 24px; padding: 25px; margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* –ë–ò–û–ú–ï–¢–†–ò–Ø –í –†–Ø–î */
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .bio-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 18px; text-align: center; }
        .bio-box label { font-size: 8px; font-weight: 900; color: var(--accent); display: block; margin-bottom: 8px; }
        .bio-box input { width: 100%; background: transparent; border: none; color: #fff; font-size: 24px; font-weight: 700; text-align: center; outline: none; }

        /* –°–ï–õ–ï–ö–¢–û–†–´ */
        .selector { display: flex; gap: 10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 20px; }
        .sel-btn { flex: 1; padding: 15px 5px; font-size: 10px; font-weight: 900; border-radius: 15px; text-align: center; color: var(--text-dim); cursor: pointer; transition: 0.4s; text-transform: uppercase; }
        .sel-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent-glow); }

        /* –ë–õ–û–ö –ë–ñ–£ */
        .bju-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); }
        .bju-card { text-align: center; padding: 15px 5px; background: rgba(205, 127, 50, 0.05); border-radius: 15px; border: 1px solid rgba(205, 127, 50, 0.1); }
        .bju-card .val { font-size: 20px; font-weight: 800; display: block; margin-bottom: 4px; }
        .bju-card .unit { font-size: 8px; font-weight: 900; color: var(--accent); }

        /* –≠–ö–°–ü–ï–†–¢–ù–´–ï –°–ö–û–ë–ö–ò */
        .expert-advice {
            border-left: 4px solid var(--accent); background: rgba(205, 127, 50, 0.05);
            padding: 20px; border-radius: 0 20px 20px 0; margin: 30px 0;
        }
        .expert-advice h6 { font-size: 9px; font-weight: 900; color: var(--accent); margin-bottom: 10px; }
        .expert-advice p { font-size: 14px; line-height: 1.6; color: #ddd; font-weight: 400; }

        /* –¢–†–ï–ù–ò–†–û–í–ö–ò */
        .w-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .w-item {
            background: var(--panel-bg); border: 1px solid var(--border);
            border-radius: 22px; padding: 25px 15px; text-align: center; transition: 0.3s;
        }
        .w-item.locked { opacity: 0.15; filter: grayscale(1); pointer-events: none; }
        .w-item h4 { font-size: 14px; font-weight: 700; margin-bottom: 8px; }
        .w-item span { font-size: 9px; color: var(--accent); font-weight: 900; letter-spacing: 1px; }

        /* –ì–†–ê–§–ò–ö–ò */
        .chart-box { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 20px; }
        .chart-label { font-size: 9px; font-weight: 900; color: var(--text-dim); margin-bottom: 15px; text-transform: uppercase; text-align: center; }

        /* –ú–û–î–ê–õ–ö–ê */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 5000; display: none;
            align-items: center; justify-content: center; padding: 30px;
        }
        .modal-inner { background: #111; border: 2px solid var(--accent); border-radius: 35px; padding: 45px 30px; width: 100%; text-align: center; }
        .modal-inner h2 { color: var(--accent); font-size: 24px; margin-bottom: 20px; font-weight: 800; }
        .modal-inner p { font-size: 15px; line-height: 1.7; color: #bbb; margin-bottom: 30px; }
        .confirm-btn { width: 100%; padding: 22px; background: var(--accent); color: #000; border: none; border-radius: 18px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }

        /* –î–ò–ü–õ–û–ú */
        #diploma-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10001; display: none; flex-direction: column;
            align-items: center; justify-content: center; padding: 40px; text-align: center;
            border: 20px solid var(--accent);
        }
    </style>
</head>
<body>

<div class="bg-fixed"></div>

<div id="scanner">
    <div class="laser"></div>
    <h2 style="letter-spacing: 15px; font-weight: 100;">MONOLITH</h2>
    <p style="font-size: 10px; color: var(--accent); font-weight: 900; margin-top: 10px;">LADY STRETCH SYKTYVKAR</p>
</div>

<header>
    <div class="logo">LADY <b>STRETCH</b></div>
    <div class="counter">
        <div id="total-count" class="counter-num">0</div>
        <div class="counter-label">–ó–ê–ù–Ø–¢–ò–ô</div>
    </div>
</header>

<div class="container">
    
    <span class="label">üß¨ –ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞</span>
    <div class="panel">
        <div class="selector" style="margin-bottom: 20px;">
            <div class="sel-btn active" id="gen-f" onclick="core.updateGen('f')">–ñ–µ–Ω—â–∏–Ω–∞</div>
            <div class="sel-btn" id="gen-m" onclick="core.updateGen('m')">–ú—É–∂—á–∏–Ω–∞</div>
        </div>
        <div class="grid-3">
            <div class="bio-box"><label>–í–ï–° (–ö–ì)</label><input type="number" id="in-w" placeholder="00" oninput="core.calculate()"></div>
            <div class="bio-box"><label>–†–û–°–¢ (–°–ú)</label><input type="number" id="in-h" placeholder="000" oninput="core.calculate()"></div>
            <div class="bio-box"><label>–í–û–ó–†–ê–°–¢</label><input type="number" id="in-a" placeholder="00" oninput="core.calculate()"></div>
        </div>
    </div>

    <span class="label">üçè –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å –∏ –ë–ñ–£</span>
    <div class="panel">
        <div class="grid-3" style="border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px;">
            <div style="text-align: center;"><span id="out-bmi" style="font-size: 22px; font-weight: 800;">--</span><br><span style="font-size: 8px; color: var(--accent); font-weight: 900;">–ò–ú–¢</span></div>
            <div style="text-align: center;"><span id="out-h2o" style="font-size: 22px; font-weight: 800;">--</span><br><span style="font-size: 8px; color: var(--accent); font-weight: 900;">–í–û–î–ê (–õ)</span></div>
            <div style="text-align: center;"><span id="out-kcal" style="font-size: 22px; font-weight: 800;">--</span><br><span style="font-size: 8px; color: var(--accent); font-weight: 900;">–ö–ö–ê–õ/–î–ï–ù–¨</span></div>
        </div>
        <div class="bju-grid">
            <div class="bju-card"><span id="out-b" class="val">--</span><span class="unit">–ë–ï–õ–ö–ò (–ì)</span></div>
            <div class="bju-card"><span id="out-j" class="val">--</span><span class="unit">–ñ–ò–†–´ (–ì)</span></div>
            <div class="bju-card"><span id="out-u" class="val">--</span><span class="unit">–£–ì–õ–ï–í. (–ì)</span></div>
        </div>
    </div>

    <span class="label">üîã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–º</span>
    <div class="panel selector">
        <div class="sel-btn" id="res-1" onclick="core.updateRes('–°–ü–ê–î', 0.85, 1)">–°–ü–ê–î</div>
        <div class="sel-btn active" id="res-2" onclick="core.updateRes('–ù–û–†–ú–ê', 1.0, 2)">–ù–û–†–ú–ê</div>
        <div class="sel-btn" id="res-3" onclick="core.updateRes('–ü–ò–ö', 1.15, 3)">–ü–ò–ö</div>
    </div>

    <span class="label">üèÉ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
    <div class="panel selector">
        <div class="sel-btn active" id="act-1" onclick="core.updateAct(1.2, 1)">–ù–∏–∑–∫–∞—è</div>
        <div class="sel-btn" id="act-2" onclick="core.updateAct(1.375, 2)">–°—Ä–µ–¥–Ω—è—è</div>
        <div class="sel-btn" id="act-3" onclick="core.updateAct(1.55, 3)">–í—ã—Å–æ–∫–∞—è</div>
        <div class="sel-btn" id="act-4" onclick="core.updateAct(1.9, 4)">MAX</div>
    </div>

    <div class="expert-advice">
        <h6>–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–°–ü–ï–†–¢–ê:</h6>
        <p id="expert-opinion">–°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥ –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.</p>
    </div>

    <span class="label">üìä –î–∏–Ω–∞–º–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–í–ï–°)</span>
    <div class="chart-box">
        <canvas id="weightChart"></canvas>
    </div>

    <span class="label">üìÖ –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ (–ü–û–°–ï–©–ï–ù–ò–Ø)</span>
    <div class="chart-box">
        <canvas id="disciplineChart"></canvas>
    </div>

    <span class="label">üßò –ü—Ä–æ—Ç–æ–∫–æ–ª—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (50 –º–∏–Ω)</span>
    <div class="w-grid" id="workouts"></div>

</div>

<div id="modal-w" class="modal" onclick="core.closeModal()">
    <div class="modal-inner" onclick="event.stopPropagation()">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <button class="confirm-btn" onclick="core.logWorkout()">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
    </div>
</div>

<div id="diploma-layer" onclick="this.style.display='none'">
    <h1 style="color: var(--accent); font-size: 50px; font-weight: 900;">–î–ò–ü–õ–û–ú</h1>
    <h3 style="letter-spacing: 5px; margin-top: 10px;">–°–¢–ê–¢–£–°: –ú–û–ù–û–õ–ò–¢</h3>
    <div style="width: 100px; height: 1px; background: var(--accent); margin: 30px 0;"></div>
    <p id="diploma-text" style="line-height: 2; font-size: 16px; max-width: 320px;"></p>
    <p style="margin-top: 40px; font-size: 10px; color: var(--accent); font-weight: 900;">LADY STRETCH SYKTYVKAR</p>
    <p style="font-size: 12px; font-weight: 800;">–ù–∏–∫–æ–ª–∞–π –•—É–¥—è–∫–æ–≤ & –û–ª—å–≥–∞</p>
</div>

<script>
const protocols = [
    { id: 'p1', n: '–ü–∏–ª–∞—Ç–µ—Å', t: 'soft', d: '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ–ª—É. –†–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –≥–ª—É–±–æ–∫–æ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–µ–π, –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–∞–Ω–∫—É –∏ —Å–æ–∑–¥–∞–µ–º ¬´—É–º–Ω—ã–π¬ª –º—ã—à–µ—á–Ω—ã–π –∫–æ—Ä—Å–µ—Ç. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ü–µ–Ω–∏—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–π.' },
    { id: 'p2', n: '–ú–§–†', t: 'soft', d: '–ú–∏–æ—Ñ–∞—Å—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑. –ì–ª—É–±–æ–∫–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ç–∫–∞–Ω—å (—Ñ–∞—Å—Ü–∏–∏). –£–±–∏—Ä–∞–µ–º ¬´–∑–∞–±–∏—Ç–æ—Å—Ç—å¬ª –º—ã—à—Ü, —É–ª—É—á—à–∞–µ–º –ª–∏–º—Ñ–æ—Ç–æ–∫ –∏ —Å–Ω–∏–º–∞–µ–º –æ—Ç–µ—á–Ω–æ—Å—Ç—å.' },
    { id: 'p3', n: '–ó–¥–æ—Ä–æ–≤–∞—è —Å–ø–∏–Ω–∞', t: 'soft', d: '–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –°–Ω–∏–º–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É —Å –ø–æ—è—Å–Ω–∏—Ü—ã –∏ —à–µ–π–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ª–µ–≥–∫–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–π.' },
    { id: 'p4', n: '–°—Ç—Ä–µ—Ç—á–∏–Ω–≥', t: 'soft', d: '–†–∞–∑–≤–∏—Ç–∏–µ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏ –≥–∏–±–∫–æ—Å—Ç–∏. –ú—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—è–Ω–µ–º—Å—è ‚Äî –º—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∞–º–ø–ª–∏—Ç—É–¥—É –¥–≤–∏–∂–µ–Ω–∏–π –∏ –¥–µ–ª–∞–µ–º —Ç–µ–ª–æ –≥—Ä–∞—Ü–∏–æ–∑–Ω—ã–º.' },
    { id: 'p5', n: 'Sky Stretching', t: 'soft', d: '–ê—ç—Ä–æ-—Å—Ç—Ä–µ—Ç—á–∏–Ω–≥ –≤ –≥–∞–º–∞–∫–∞—Ö. –î–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –ø–æ–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º. –û—â—É—â–µ–Ω–∏–µ –Ω–µ–≤–µ—Å–æ–º–æ—Å—Ç–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç—è–∂–∫–∏.' },
    { id: 'p6', n: '–ü–æ–¥–∫–∞—á–∫–∞ + –†–∞—Å—Ç—è–∂–∫–∞', t: 'hard', d: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∏–∫—Å. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–Ω—É—Å –º—ã—à—Ü, –∑–∞—Ç–µ–º —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∏—Ö, —Ñ–æ—Ä–º–∏—Ä—É—è –¥–ª–∏–Ω–Ω—ã–π –∏ —Å—É—Ö–æ–π —Ä–µ–ª—å–µ—Ñ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ –æ–±—ä–µ–º–∞.' },
    { id: 'p7', n: '–Ø–≥–æ–¥–∏—Ü—ã + –ü—Ä–µ—Å—Å', t: 'hard', d: '–°–∏–ª–æ–≤–æ–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –∑–æ–Ω—ã. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–æ–π —è–≥–æ–¥–∏—á–Ω–æ–π –º—ã—à—Ü—ã –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º—ã—à—Ü –∂–∏–≤–æ—Ç–∞.' },
    { id: 'p8', n: '–ö—Ä—É–≥–æ–≤–∞—è', t: 'hard', d: '–ú–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∏–π –≤–∑—Ä—ã–≤. –í—ã—Å–æ–∫–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å, —Ä–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—à–µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.' },
    { id: 'p9', n: 'Body Sculpt', t: 'hard', d: '–°–∏–ª–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞. –†–∞–±–æ—Ç–∞ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –Ω–∞–¥ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–æ–π –º—ã—à—Ü –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—É—Ä–æ–≤ —Ç–µ–ª–∞.' },
    { id: 'p10', n: '–¢–∞–±–∞—Ç–∞', t: 'hard', d: '–Ø–ø–æ–Ω—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ 20/10. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–≥–æ–Ω –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.' },
    { id: 'p11', n: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª', t: 'hard', d: '–†–∞–∑–≤–∏—Ç–∏–µ 5 —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∫–∞—á–µ—Å—Ç–≤. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–ª–∞ –∫ –ª—é–±—ã–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º –Ω–∞–≥—Ä—É–∑–∫–∞–º —á–µ—Ä–µ–∑ —Å–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—Å—É—Å—Ç–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è.' },
    { id: 'p12', n: '–ô–æ–≥–∞ –†–µ–ª–∞–∫—Å', t: 'soft', d: '–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–≥—Ä—É–∑–∫–∞. –†–∞–±–æ—Ç–∞ —Å –¥—ã—Ö–∞–Ω–∏–µ–º –∏ –≥–ª—É–±–æ–∫–æ–π —Å—Ç–∞—Ç–∏–∫–æ–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ –∏ –∫–æ—Ä—Ç–∏–∑–æ–ª–∞.' }
];

class MonolithCore {
    constructor() {
        this.data = JSON.parse(localStorage.getItem('ls_monolith_absolute')) || {
            gen: 'f', w: '', h: '', a: '', act: 1.2, actI: 1, res: 1.0, resI: 2, resN: '–ù–û–†–ú–ê',
            logs: {}, weightHistory: [], activityHistory: [0,0,0,0,0,0,0], dates: []
        };
        this.activeId = null;
        this.init();
    }

    init() {
        setTimeout(() => { document.getElementById('scanner').style.opacity = '0'; setTimeout(()=>document.getElementById('scanner').style.display='none', 1500); }, 2500);
        document.getElementById('in-w').value = this.data.w;
        document.getElementById('in-h').value = this.data.h;
        document.getElementById('in-a').value = this.data.a;
        this.updateGen(this.data.gen);
        this.updateAct(this.data.act, this.data.actI);
        this.updateRes(this.data.resN, this.data.res, this.data.resI);
        this.renderWorkouts();
        this.calculate();
        this.renderCharts();
    }

    updateGen(g) { this.data.gen = g; document.getElementById('gen-f').classList.toggle('active', g==='f'); document.getElementById('gen-m').classList.toggle('active', g==='m'); this.calculate(); }
    updateAct(v, i) { this.data.act = v; this.data.actI = i; for(let j=1;j<=4;j++) document.getElementById('act-'+j).classList.remove('active'); document.getElementById('act-'+i).classList.add('active'); this.calculate(); }
    updateRes(n, v, i) { this.data.resN = n; this.data.res = v; this.data.resI = i; for(let j=1;j<=3;j++) document.getElementById('res-'+j).classList.remove('active'); document.getElementById('res-'+i).classList.add('active'); this.calculate(); this.renderWorkouts(); }

    calculate() {
        const w = parseFloat(document.getElementById('in-w').value);
        const h = parseFloat(document.getElementById('in-h').value);
        const a = parseInt(document.getElementById('in-a').value);
        if(w && h && a) {
            this.data.w = w; this.data.h = h; this.data.a = a;
            const bmi = (w / ((h/100)**2)).toFixed(1);
            let bmr = (10 * w + 6.25 * h - 5 * a + (this.data.gen==='m'?5:-161)) * this.data.act * this.data.res;
            
            document.getElementById('out-bmi').innerText = bmi;
            document.getElementById('out-h2o').innerText = (w * 0.035).toFixed(1);
            document.getElementById('out-kcal').innerText = Math.round(bmr);
            document.getElementById('out-b').innerText = Math.round((bmr * 0.3) / 4);
            document.getElementById('out-j').innerText = Math.round((bmr * 0.25) / 9);
            document.getElementById('out-u').innerText = Math.round((bmr * 0.45) / 4);

            const exp = document.getElementById('expert-opinion');
            if(this.data.resN === '–°–ü–ê–î') exp.innerHTML = "<b>–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ï–°–£–†–°.</b> –û—Ä–≥–∞–Ω–∏–∑–º –≤ —Ä–µ–∂–∏–º–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è. –°–∏–ª–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ú–§–† –¥–ª—è –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.";
            else if(bmi > 25) exp.innerHTML = "<b>–ê–ù–ê–õ–ò–ó:</b> –ò–ú–¢ –≤—ã—à–µ –Ω–æ—Ä–º—ã. –ê–∫—Ü–µ–Ω—Ç –Ω–∞ –∂–∏—Ä–æ—Å–∂–∏–≥–∞—é—â–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (–¢–∞–±–∞—Ç–∞, –ö—Ä—É–≥–æ–≤–∞—è) –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —É–≥–ª–µ–≤–æ–¥–Ω–æ–≥–æ –æ–∫–Ω–∞.";
            else exp.innerHTML = "<b>–ù–û–†–ú–ê:</b> –¢–µ–ª–æ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏. –°–æ—á–µ—Ç–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–∏–Ω–≥ —Å–æ Sky Stretching –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∏–ª—ã –∏ –≥–∏–±–∫–æ—Å—Ç–∏.";

            if(this.data.weightHistory[this.data.weightHistory.length-1] !== w) {
                this.data.weightHistory.push(w);
                this.data.dates.push(new Date().toLocaleDateString('ru',{day:'numeric',month:'short'}));
                this.renderCharts();
            }
            this.save();
        }
    }

    renderWorkouts() {
        const grid = document.getElementById('workouts'); grid.innerHTML = '';
        protocols.forEach(p => {
            const count = this.data.logs[p.id] || 0;
            const locked = this.data.resN === '–°–ü–ê–î' && p.t === 'hard';
            grid.innerHTML += `<div class="w-item ${locked?'locked':''}" onclick="core.openModal('${p.id}')"><h4>${p.n}</h4><span>${count} –°–ï–ê–ù–°–û–í</span></div>`;
        });
        document.getElementById('total-count').innerText = Object.values(this.data.logs).reduce((a,b)=>a+b,0);
        if(Object.values(this.data.logs).reduce((a,b)=>a+b,0) >= 150) this.showDiploma();
    }

    openModal(id) { this.activeId = id; const p = protocols.find(x=>x.id===id); document.getElementById('modal-title').innerText = p.n; document.getElementById('modal-desc').innerText = p.d; document.getElementById('modal-w').style.display='flex'; }
    closeModal() { document.getElementById('modal-w').style.display='none'; }

    logWorkout() {
        this.data.logs[this.activeId] = (this.data.logs[this.activeId] || 0) + 1;
        const day = new Date().getDay();
        this.data.activityHistory[day === 0 ? 6 : day - 1]++;
        window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        this.save(); this.renderWorkouts(); this.renderCharts(); this.closeModal();
    }

    renderCharts() {
        const ctxW = document.getElementById('weightChart').getContext('2d');
        if(this.chW) this.chW.destroy();
        this.chW = new Chart(ctxW, {
            type: 'line',
            data: { labels: this.data.dates.slice(-7), datasets: [{ data: this.data.weightHistory.slice(-7), borderColor: '#CD7F32', tension: 0.4, borderWeight: 3, pointRadius: 2, fill: true, backgroundColor: 'rgba(205,127,50,0.05)' }] },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: '#222' }, ticks: { color: '#555' } } } }
        });

        const ctxA = document.getElementById('disciplineChart').getContext('2d');
        if(this.chA) this.chA.destroy();
        this.chA = new Chart(ctxA, {
            type: 'bar',
            data: { labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'], datasets: [{ data: this.data.activityHistory, backgroundColor: '#CD7F32', borderRadius: 8 }] },
            options: { plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: '#222' }, ticks: { color: '#555', stepSize: 1 } } } }
        });
    }

    showDiploma() {
        document.getElementById('diploma-text').innerText = "–ù–∏–∫–æ–ª–∞–π –•—É–¥—è–∫–æ–≤ –∏ –û–ª—å–≥–∞ –ø–æ–∑–¥—Ä–∞–≤–ª—è—é—Ç –≤–∞—Å! –ü—Ä–æ–π–¥—è 150 —Å–µ—Å—Å–∏–π, –≤—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ú–û–ù–û–õ–ò–¢. –≠—Ç–æ –≤—ã—Å—à–∞—è —Å—Ç–µ–ø–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è —Å–≤–æ–∏–º —Ç–µ–ª–æ–º –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–æ–π.";
        document.getElementById('diploma-layer').style.display = 'flex';
    }

    save() { localStorage.setItem('ls_monolith_absolute', JSON.stringify(this.data)); }
}
const core = new MonolithCore();
</script>
</body>
</html>
