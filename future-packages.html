<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lady Stretch | Absolute Monolith</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* –ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞: –ì—Ä–∞—Ñ–∏—Ç, –ì–ª—É–±–æ–∫–∏–π —á–µ—Ä–Ω—ã–π –∏ –ú–∞—Ç–æ–≤–∞—è –ë—Ä–æ–Ω–∑–∞ (–Ω–∏–∫–∞–∫–æ–≥–æ –¥–µ—à–µ–≤–æ–≥–æ –∂–µ–ª—Ç–æ–≥–æ) */
            --bronze: #B87333;
            --bronze-dim: rgba(184, 115, 51, 0.15);
            --bg-main: #050505;
            --bg-panel: #121212;
            --border-color: #2a2a2a;
            --text-main: #ffffff;
            --text-muted: #888888;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-main); color: var(--text-main); font-family: 'Inter', sans-serif; padding-bottom: 60px; overflow-x: hidden; }

        /* HEADER */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-color);
            padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;
        }
        .brand { font-size: 18px; font-weight: 300; letter-spacing: 4px; text-transform: uppercase; }
        .brand b { color: var(--bronze); font-weight: 900; }
        .stats-header { text-align: right; }
        .stats-header .val { font-size: 28px; font-weight: 900; color: var(--bronze); line-height: 1; }
        .stats-header .lbl { font-size: 9px; font-weight: 700; color: var(--text-muted); letter-spacing: 2px; margin-top: 4px; }

        .container { padding: 25px; max-width: 600px; margin: 0 auto; }

        .section-title {
            font-size: 11px; font-weight: 900; color: var(--bronze);
            text-transform: uppercase; letter-spacing: 3px;
            margin: 35px 0 15px 5px; display: block;
        }

        .card { background: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* –ë–ò–û–ú–ï–¢–†–ò–Ø */
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .input-box { background: #1a1a1a; padding: 15px 10px; border-radius: 15px; text-align: center; border: 1px solid transparent; transition: 0.3s; }
        .input-box:focus-within { border-color: var(--bronze); background: #000; }
        .input-box label { font-size: 9px; color: var(--bronze); display: block; margin-bottom: 8px; font-weight: 900; letter-spacing: 1px; }
        .input-box input { width: 100%; background: transparent; border: none; color: #fff; font-size: 24px; font-weight: 700; text-align: center; outline: none; }

        /* –ë–ñ–£ */
        .bju-container { margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--border-color); }
        .bju-header { display: flex; justify-content: space-between; margin-bottom: 15px; text-align: center; }
        .bju-header div { flex: 1; }
        .bju-header .v { font-size: 22px; font-weight: 900; display: block; }
        .bju-header .l { font-size: 9px; color: var(--text-muted); font-weight: 700; }
        
        .bju-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .bju-item { background: var(--bronze-dim); border: 1px solid rgba(184, 115, 51, 0.3); padding: 15px 5px; border-radius: 12px; text-align: center; }
        .bju-item .v { font-size: 18px; font-weight: 900; color: #fff; display: block; margin-bottom: 4px; }
        .bju-item .l { font-size: 8px; color: var(--bronze); font-weight: 900; text-transform: uppercase; }

        /* –°–ï–õ–ï–ö–¢–û–†–´ */
        .selector-wrap { display: flex; gap: 8px; background: #1a1a1a; padding: 6px; border-radius: 16px; }
        .selector-btn { flex: 1; padding: 16px 5px; text-align: center; font-size: 10px; font-weight: 900; border-radius: 12px; color: var(--text-muted); cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; }
        .selector-btn.active { background: var(--bronze); color: #000; box-shadow: 0 4px 15px rgba(184, 115, 51, 0.3); }

        /* –≠–ö–°–ü–ï–†–¢–ù–´–ô –ë–õ–û–ö */
        .expert-block { border-left: 4px solid var(--bronze); background: linear-gradient(90deg, #1a1a1a 0%, transparent 100%); padding: 25px; margin: 25px 0; border-radius: 0 15px 15px 0; }
        .expert-block h4 { font-size: 11px; color: var(--bronze); margin-bottom: 12px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
        .expert-block p { font-size: 14px; line-height: 1.7; color: #d1d1d1; font-weight: 300; }

        /* –ì–†–ê–§–ò–ö–ò */
        .chart-wrapper { height: 260px; width: 100%; position: relative; }

        /* –¢–†–ï–ù–ò–†–û–í–ö–ò */
        .workouts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .workout-card { background: #1a1a1a; border: 1px solid var(--border-color); padding: 25px 15px; border-radius: 18px; text-align: center; transition: 0.3s; position: relative; overflow: hidden; }
        .workout-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: var(--bronze); opacity: 0; transition: 0.3s; }
        .workout-card:active::before { opacity: 1; }
        .workout-card.locked { opacity: 0.2; filter: grayscale(100%); pointer-events: none; border-color: transparent; }
        .workout-card h3 { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: #fff; }
        .workout-card .duration { font-size: 9px; color: var(--text-muted); display: block; margin-bottom: 8px; font-weight: 600; }
        .workout-card .count { font-size: 10px; color: var(--bronze); font-weight: 900; letter-spacing: 1px; background: var(--bronze-dim); padding: 4px 8px; border-radius: 6px; display: inline-block; }

        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background: var(--bg-panel); border: 1px solid var(--bronze); padding: 35px 25px; border-radius: 24px; text-align: center; width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .modal-content h2 { color: var(--bronze); font-size: 22px; font-weight: 900; margin-bottom: 15px; text-transform: uppercase; }
        .modal-content p { font-size: 15px; line-height: 1.6; color: #ccc; margin-bottom: 30px; font-weight: 300; }
        .btn-confirm { width: 100%; padding: 20px; background: var(--bronze); color: #000; border: none; border-radius: 15px; font-size: 14px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; }

        /* –î–ò–ü–õ–û–ú */
        .diploma-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; border: 10px solid var(--bronze); }
        .diploma-overlay h1 { color: var(--bronze); font-size: 42px; font-weight: 900; letter-spacing: 8px; margin-bottom: 20px; }
        .diploma-overlay p { font-size: 16px; color: #fff; line-height: 1.8; margin-bottom: 40px; }
        .diploma-overlay .sign { font-size: 12px; color: var(--bronze); font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
    </style>
</head>
<body>

<header>
    <div class="brand">LADY <b>STRETCH</b><br><span style="font-size: 8px; color: var(--text-muted); font-weight: 700; letter-spacing: 2px;">SYKTYVKAR</span></div>
    <div class="stats-header">
        <div id="total-sessions" class="val">0</div>
        <div class="lbl">–°–ï–ê–ù–°–û–í</div>
    </div>
</header>

<div class="container">
    
    <span class="section-title">üß¨ –ë–∏–æ–º–µ—Ç—Ä–∏—è –∏ –≠–Ω–µ—Ä–≥–∏—è</span>
    <div class="card">
        <div class="selector-wrap" style="margin-bottom: 20px;">
            <div class="selector-btn active" id="gen-f" onclick="app.setGender('f')">–ñ–µ–Ω—â–∏–Ω–∞</div>
            <div class="selector-btn" id="gen-m" onclick="app.setGender('m')">–ú—É–∂—á–∏–Ω–∞</div>
        </div>
        <div class="grid-3">
            <div class="input-box"><label>–í–ï–° (–ö–ì)</label><input type="number" id="inp-w" placeholder="00" oninput="app.calculate()"></div>
            <div class="input-box"><label>–†–û–°–¢ (–°–ú)</label><input type="number" id="inp-h" placeholder="000" oninput="app.calculate()"></div>
            <div class="input-box"><label>–í–û–ó–†–ê–°–¢</label><input type="number" id="inp-a" placeholder="00" oninput="app.calculate()"></div>
        </div>

        <div class="bju-container">
            <div class="bju-header">
                <div><span id="out-bmi" class="v">--</span><span class="l">–ò–ú–¢</span></div>
                <div><span id="out-h2o" class="v">--</span><span class="l">–í–û–î–ê (–õ)</span></div>
                <div><span id="out-kcal" class="v" style="color: var(--bronze);">--</span><span class="l">–ö–ö–ê–õ / –°–£–¢–ö–ò</span></div>
            </div>
            <div class="bju-grid">
                <div class="bju-item"><span id="out-b" class="v">--</span><span class="l">–ë–µ–ª–∫–∏</span></div>
                <div class="bju-item"><span id="out-j" class="v">--</span><span class="l">–ñ–∏—Ä—ã</span></div>
                <div class="bju-item"><span id="out-u" class="v">--</span><span class="l">–£–≥–ª–µ–≤–æ–¥—ã</span></div>
            </div>
        </div>
    </div>

    <span class="section-title">üîã –ú–∞—Ç—Ä–∏—Ü–∞ –†–µ—Å—É—Ä—Å–∞</span>
    <div class="card selector-wrap">
        <div class="selector-btn" id="res-1" onclick="app.setResource('–°–ü–ê–î', 0.85, 1)">–°–ø–∞–¥</div>
        <div class="selector-btn active" id="res-2" onclick="app.setResource('–ù–û–†–ú–ê', 1.0, 2)">–ù–æ—Ä–º–∞</div>
        <div class="selector-btn" id="res-3" onclick="app.setResource('–ü–ò–ö', 1.15, 3)">–ü–∏–∫</div>
    </div>

    <div class="expert-block">
        <h4>–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –¢–†–ï–ù–ï–†–ê:</h4>
        <p id="expert-text">–û–∂–∏–¥–∞—é –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –í–≤–µ–¥–∏—Ç–µ –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç.</p>
    </div>

    <span class="section-title">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –í–µ—Å</span>
    <div class="card chart-wrapper">
        <canvas id="weightChart"></canvas>
    </div>

    <span class="section-title">üìÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</span>
    <div class="card chart-wrapper">
        <canvas id="activityChart"></canvas>
    </div>

    <span class="section-title">üßò –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏</span>
    <div class="workouts-grid" id="workouts-render"></div>

</div>

<div id="modal-workout" class="modal-overlay" onclick="app.closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="mw-title">–ü—Ä–æ—Ç–æ–∫–æ–ª</h2>
        <span style="display: block; font-size: 11px; color: var(--bronze); font-weight: 900; margin-bottom: 20px; text-transform: uppercase;">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 50 –º–∏–Ω—É—Ç</span>
        <p id="mw-desc">–û–ø–∏—Å–∞–Ω–∏–µ</p>
        <button class="btn-confirm" onclick="app.confirmWorkout()">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∞–Ω—Å</button>
    </div>
</div>

<div id="diploma" class="diploma-overlay" onclick="this.style.display='none'">
    <h1>–ú–û–ù–û–õ–ò–¢</h1>
    <h3 style="color: var(--text-muted); letter-spacing: 5px; margin-bottom: 30px; font-weight: 300;">–°–¢–ê–¢–£–° –î–û–°–¢–ò–ì–ù–£–¢</h3>
    <p>–í—ã –ø—Ä–æ—à–ª–∏ 150 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö —Å–µ—Å—Å–∏–π. –≠—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–∞–ª—å–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, —É–≤–∞–∂–µ–Ω–∏—è –∫ —Å–≤–æ–µ–º—É —Ç–µ–ª—É –∏ –≤—ã—Å–æ—á–∞–π—à–µ–≥–æ —É—Ä–æ–≤–Ω—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏. –í—ã –¥–æ–∫–∞–∑–∞–ª–∏, —á—Ç–æ —Å–ø–æ—Å–æ–±–Ω—ã –Ω–∞ –≤—Å—ë.</p>
    <div class="sign">–° —É–≤–∞–∂–µ–Ω–∏–µ–º,<br><br>–°—Ç—É–¥–∏—è Lady Stretch (–°—ã–∫—Ç—ã–≤–∫–∞—Ä)<br>–¢—Ä–µ–Ω–µ—Ä –û–ª—å–≥–∞</div>
</div>

<script>
// –ü–û–õ–ù–ê–Ø –ë–ê–ó–ê 12 –ü–†–û–¢–û–ö–û–õ–û–í (–ë–ï–ó –°–û–ö–†–ê–©–ï–ù–ò–ô)
const workoutsData = [
    { id: 'w1', name: '–ü–∏–ª–∞—Ç–µ—Å', type: 'soft', desc: '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å. –ì–ª—É–±–æ–∫–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ –º—ã—à—Ü-—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–æ–≤, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–π—Ä–æ–º—ã—à–µ—á–Ω–æ–π —Å–≤—è–∑–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–∫–æ–≥–æ –º—ã—à–µ—á–Ω–æ–≥–æ –∫–æ—Ä—Å–µ—Ç–∞. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Å–∞–Ω–∫–∏.' },
    { id: 'w2', name: '–ú–§–†', type: 'soft', desc: '–ú–∏–æ—Ñ–∞—Å—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑. –ú–æ—â–Ω—ã–π –ª–∏–º—Ñ–æ–¥—Ä–µ–Ω–∞–∂ –∏ —Å–Ω—è—Ç–∏–µ —Å–ø–∞–∑–º–æ–≤ —Å –ø–æ–º–æ—â—å—é —Ä–æ–ª–ª–æ–≤. –†–∞—Å–∫–∞—Ç—ã–≤–∞–µ–º —Ñ–∞—Å—Ü–∏–∏, —É–±–∏—Ä–∞–µ–º ¬´–∑–∞–±–∏—Ç–æ—Å—Ç—å¬ª –∏ —É—Å–∫–æ—Ä—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.' },
    { id: 'w3', name: '–ó–¥–æ—Ä–æ–≤–∞—è —Å–ø–∏–Ω–∞', type: 'soft', desc: '–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –°–Ω–∏–º–∞–µ–º –∫–æ–º–ø—Ä–µ—Å—Å–∏—é —Å –ø–æ–∑–≤–æ–Ω–∫–æ–≤, —É–±–∏—Ä–∞–µ–º –±–æ–ª–∏ –≤ —à–µ–π–Ω–æ–º –∏ –ø–æ—è—Å–Ω–∏—á–Ω–æ–º –æ—Ç–¥–µ–ª–∞—Ö. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ª–µ–≥–∫–æ—Å—Ç—å –∫–∞–∂–¥–æ–º—É –¥–≤–∏–∂–µ–Ω–∏—é.' },
    { id: 'w4', name: '–°—Ç—Ä–µ—Ç—á–∏–Ω–≥', type: 'soft', desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–æ–∫ –∏ –º—ã—à—Ü. –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∞–º–ø–ª–∏—Ç—É–¥—É –¥–≤–∏–∂–µ–Ω–∏–π, —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –≥—Ä–∞—Ü–∏–µ–π –∏ —Å–Ω–∏–º–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.' },
    { id: 'w5', name: 'Sky Stretching', type: 'soft', desc: '–†–∞—Å—Ç—è–∂–∫–∞ –≤ –≥–∞–º–∞–∫–∞—Ö. –ú—è–≥–∫–∞—è –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞ –ø–æ–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞. –†–∞–±–æ—Ç–∞ —Å –≤–µ—Å—Ç–∏–±—É–ª—è—Ä–Ω—ã–º –∞–ø–ø–∞—Ä–∞—Ç–æ–º –∏ –≥–ª—É–±–æ–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ.' },
    { id: 'w6', name: '–ü–æ–¥–∫–∞—á–∫–∞ + –†–∞—Å—Ç—è–∂–∫–∞', type: 'hard', desc: '–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å. –°–Ω–∞—á–∞–ª–∞ –¥–∞–µ–º —Å–∏–ª–æ–≤–æ–π —Å—Ç–∏–º—É–ª –¥–ª—è —Ç–æ–Ω—É—Å–∞ –º—ã—à—Ü, –∑–∞—Ç–µ–º –≤—ã—Ç—è–≥–∏–≤–∞–µ–º –∏—Ö, —Ñ–æ—Ä–º–∏—Ä—É—è –¥–ª–∏–Ω–Ω—ã–π, —ç—Å—Ç–µ—Ç–∏—á–Ω—ã–π –∏ —Ä–µ–ª—å–µ—Ñ–Ω—ã–π —Å–∏–ª—É—ç—Ç.' },
    { id: 'w7', name: '–Ø–≥–æ–¥–∏—Ü—ã + –ü—Ä–µ—Å—Å', type: 'hard', desc: '–¢–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏–ª–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏ –±–∞–∑–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–æ–ª—å—à—É—é —è–≥–æ–¥–∏—á–Ω—É—é –º—ã—à—Ü—É –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–ª–æ–µ–≤ –º—ã—à—Ü –∂–∏–≤–æ—Ç–∞.' },
    { id: 'w8', name: '–ö—Ä—É–≥–æ–≤–∞—è', type: 'hard', desc: '–ú–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∏–Ω–≥. –†–∞–±–æ—Ç–∞ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—è—Ö —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –æ—Ç–¥—ã—Ö–æ–º. –°–∂–∏–≥–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –∫–∞–ª–æ—Ä–∏–π –∏ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —Å–∏–ª–æ–≤—É—é –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å. –¢–æ–ª—å–∫–æ –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö –ø–∞—Ö–∞—Ç—å.' },
    { id: 'w9', name: 'Body Sculpt', type: 'hard', desc: '–°–∏–ª–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ–ª–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–æ—Ç–Ω–æ–π –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã –∏ –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞.' },
    { id: 'w10', name: '–¢–∞–±–∞—Ç–∞', type: 'hard', desc: '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π –≤—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–∏–Ω–≥ (–í–ò–ò–¢). –†–∞–∑–≥–æ–Ω—è–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º —Ç–∞–∫, —á—Ç–æ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞.' },
    { id: 'w11', name: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª', type: 'hard', desc: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π. –í–∫–ª—é—á–∞–µ—Ç –≤ —Ä–∞–±–æ—Ç—É –≤—Å—ë —Ç–µ–ª–æ —Å—Ä–∞–∑—É, —Ä–∞–∑–≤–∏–≤–∞—è —Å–∏–ª—É, —Å–∫–æ—Ä–æ—Å—Ç—å, –≥–∏–±–∫–æ—Å—Ç—å –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.' },
    { id: 'w12', name: '–ô–æ–≥–∞ –†–µ–ª–∞–∫—Å', type: 'soft', desc: '–ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞ —Å –¥—ã—Ö–∞–Ω–∏–µ–º –¥–ª—è —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∏ —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞.' }
];

class MonolithApp {
    constructor() {
        this.db = JSON.parse(localStorage.getItem('monolith_data_v6_2')) || {
            gen: 'f', weight: '', height: '', age: '', 
            resName: '–ù–û–†–ú–ê', resVal: 1.0, resIdx: 2,
            logs: {}, weightHistory: [], activityHistory: [0,0,0,0,0,0,0], dates: []
        };
        this.currentWorkoutId = null;
        this.init();
    }

    init() {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        document.getElementById('inp-w').value = this.db.weight;
        document.getElementById('inp-h').value = this.db.height;
        document.getElementById('inp-a').value = this.db.age;
        this.setGender(this.db.gen, false);
        this.setResource(this.db.resName, this.db.resVal, this.db.resIdx, false);
        
        this.calculate();
        this.renderWorkouts();
        this.initCharts();
    }

    setGender(g, calc = true) {
        this.db.gen = g;
        document.getElementById('gen-f').classList.toggle('active', g === 'f');
        document.getElementById('gen-m').classList.toggle('active', g === 'm');
        if(calc) this.calculate();
    }

    setResource(name, val, idx, calc = true) {
        this.db.resName = name; this.db.resVal = val; this.db.resIdx = idx;
        for(let j=1; j<=3; j++) document.getElementById('res-'+j).classList.remove('active');
        document.getElementById('res-'+idx).classList.add('active');
        if(calc) { this.calculate(); this.renderWorkouts(); }
    }

    calculate() {
        const w = parseFloat(document.getElementById('inp-w').value);
        const h = parseFloat(document.getElementById('inp-h').value);
        const a = parseInt(document.getElementById('inp-a').value);

        if(w && h && a) {
            this.db.weight = w; this.db.height = h; this.db.age = a;
            
            // –†–∞—Å—á–µ—Ç—ã –ò–ú–¢ –∏ –í–æ–¥—ã
            const bmi = (w / Math.pow(h/100, 2)).toFixed(1);
            const water = (w * 0.035).toFixed(1);
            
            // –§–æ—Ä–º—É–ª–∞ –ú–∏—Ñ—Ñ–ª–∏–Ω–∞-–°–∞–Ω –ñ–µ–æ—Ä–∞ (–ë–∞–∑–æ–≤—ã–π –æ–±–º–µ–Ω * –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ 1.2 * –†–µ—Å—É—Ä—Å)
            let bmr = (10 * w) + (6.25 * h) - (5 * a);
            bmr = this.db.gen === 'm' ? bmr + 5 : bmr - 161;
            const totalKcal = Math.round(bmr * 1.2 * this.db.resVal);

            // –ë–ñ–£: –ë–µ–ª–∫–∏ (1.5–≥/–∫–≥), –ñ–∏—Ä—ã (0.8–≥/–∫–≥), –£–≥–ª–µ–≤–æ–¥—ã (–æ—Å—Ç–∞—Ç–æ–∫ –∫–∞–ª–æ—Ä–∏–π)
            const protein = Math.round(w * 1.5);
            const fat = Math.round(w * 0.8);
            const carbsKcal = totalKcal - (protein * 4) - (fat * 9);
            const carbs = Math.round(carbsKcal > 0 ? carbsKcal / 4 : 0);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM
            document.getElementById('out-bmi').innerText = bmi;
            document.getElementById('out-h2o').innerText = water;
            document.getElementById('out-kcal').innerText = totalKcal;
            document.getElementById('out-b').innerText = protein;
            document.getElementById('out-j').innerText = fat;
            document.getElementById('out-u').innerText = carbs;

            // –õ–æ–≥–∏–∫–∞ –≠–∫—Å–ø–µ—Ä—Ç–∞
            const expertBlock = document.getElementById('expert-text');
            if (this.db.resName === '–°–ü–ê–î') {
                expertBlock.innerHTML = "<b>–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–†–û–í–ï–ù–¨ –†–ï–°–£–†–°–ê.</b><br>–°–∏–ª–æ–≤—ã–µ (Hard) —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ —Ç—Ä–∞–≤–º –∏ –ø–µ—Ä–µ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏. –°–µ–≥–æ–¥–Ω—è –ø–æ–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –ú–§–†, –ó–¥–æ—Ä–æ–≤–∞—è —Å–ø–∏–Ω–∞ –∏–ª–∏ –ô–æ–≥–∞. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å.";
            } else if (bmi > 25) {
                expertBlock.innerHTML = "<b>–ê–ù–ê–õ–ò–ó:</b> –ò–ú–¢ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏–∑–±—ã—Ç–æ–∫ –º–∞—Å—Å—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ñ–æ–∫—É—Å –Ω–∞ –∂–∏—Ä–æ—Å–∂–∏–≥–∞—é—â–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (–ö—Ä—É–≥–æ–≤–∞—è, –¢–∞–±–∞—Ç–∞) –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å–æ —Å—Ç—Ä–æ–≥–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —É–≥–ª–µ–≤–æ–¥–æ–≤.";
            } else {
                expertBlock.innerHTML = "<b>–ê–ù–ê–õ–ò–ó:</b> –ë–∏–æ–º–µ—Ç—Ä–∏—è –≤ –Ω–æ—Ä–º–µ. –¢–µ–ª–æ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏. –ß–µ—Ä–µ–¥—É–π—Ç–µ —Å–∏–ª–æ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Å —Ä–∞—Å—Ç—è–∂–∫–æ–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞.";
            }

            // –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Å–∞
            const today = new Date().toLocaleDateString('ru', {day: 'numeric', month: 'short'});
            if(this.db.weightHistory.length === 0 || this.db.weightHistory[this.db.weightHistory.length-1] !== w) {
                this.db.weightHistory.push(w);
                this.db.dates.push(today);
                this.updateCharts();
            }
            this.saveData();
        }
    }

    renderWorkouts() {
        const container = document.getElementById('workouts-render');
        container.innerHTML = '';
        let total = 0;

        workoutsData.forEach(w => {
            const count = this.db.logs[w.id] || 0;
            total += count;
            
            // –ñ–ï–°–¢–ö–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê
            const isLocked = (this.db.resName === '–°–ü–ê–î' && w.type === 'hard');
            
            container.innerHTML += `
                <div class="workout-card ${isLocked ? 'locked' : ''}" onclick="app.openModal('${w.id}')">
                    <h3>${w.name}</h3>
                    <span class="duration">50 –ú–ò–ù–£–¢</span>
                    <span class="count">${count} –°–ï–ê–ù–°–û–í</span>
                </div>
            `;
        });

        document.getElementById('total-sessions').innerText = total;
        if (total >= 150) document.getElementById('diploma').style.display = 'flex';
    }

    openModal(id) {
        this.currentWorkoutId = id;
        const workout = workoutsData.find(w => w.id === id);
        document.getElementById('mw-title').innerText = workout.name;
        document.getElementById('mw-desc').innerText = workout.desc;
        document.getElementById('modal-workout').classList.add('active');
        // –•–∞–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –¥–ª—è Telegram WebApp (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
            window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
        }
    }

    closeModal() {
        document.getElementById('modal-workout').classList.remove('active');
    }

    confirmWorkout() {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        this.db.logs[this.currentWorkoutId] = (this.db.logs[this.currentWorkoutId] || 0) + 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–µ—â–µ–Ω–∏–π –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ (0 - –ü–Ω, 6 - –í—Å)
        let dayIdx = new Date().getDay() - 1;
        if (dayIdx === -1) dayIdx = 6; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        this.db.activityHistory[dayIdx]++;
        
        if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
            window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        }

        this.saveData();
        this.renderWorkouts();
        this.updateCharts();
        this.closeModal();
    }

    initCharts() {
        Chart.defaults.color = '#888';
        Chart.defaults.font.family = 'Inter';

        const ctxW = document.getElementById('weightChart').getContext('2d');
        this.chartW = new Chart(ctxW, {
            type: 'line',
            data: { 
                labels: this.db.dates.slice(-10), 
                datasets: [{ 
                    data: this.db.weightHistory.slice(-10), 
                    borderColor: '#B87333', 
                    borderWidth: 3,
                    tension: 0.4, 
                    pointBackgroundColor: '#B87333',
                    pointRadius: 4,
                    fill: true, 
                    backgroundColor: 'rgba(184, 115, 51, 0.1)' 
                }] 
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } }, 
                scales: { 
                    x: { grid: { display: false } }, 
                    y: { grid: { color: '#2a2a2a' }, beginAtZero: false } 
                } 
            }
        });

        const ctxA = document.getElementById('activityChart').getContext('2d');
        this.chartA = new Chart(ctxA, {
            type: 'bar',
            data: { 
                labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'], 
                datasets: [{ 
                    data: this.db.activityHistory, 
                    backgroundColor: '#B87333', 
                    borderRadius: 6 
                }] 
            },
            options: { 
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } }, 
                scales: { 
                    x: { grid: { display: false } }, 
                    y: { grid: { color: '#2a2a2a' }, beginAtZero: true, ticks: { stepSize: 1 } } 
                } 
            }
        });
    }

    updateCharts() {
        if(this.chartW) {
            this.chartW.data.labels = this.db.dates.slice(-10);
            this.chartW.data.datasets[0].data = this.db.weightHistory.slice(-10);
            this.chartW.update();
        }
        if(this.chartA) {
            this.chartA.data.datasets[0].data = this.db.activityHistory;
            this.chartA.update();
        }
    }

    saveData() {
        localStorage.setItem('monolith_data_v6_2', JSON.stringify(this.db));
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const app = new MonolithApp();
</script>
</body>
</html>
